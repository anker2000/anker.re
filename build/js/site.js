function addProject(e,a){function o(){r.screenWidth=screenWidthFromDistance(camera.position.z),console.log(r.screenWidth)}var t=new THREE.Group,r={};$(window).bind("resize",o),o();var s=new THREE.JSONLoader,n=new THREE.MeshBasicMaterial({color:16777215}),l=$(e).find("video")[0],d=(new THREE.CubeTextureLoader).load(["models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg"]);d.format=THREE.RGBFormat;var m=new THREE.VideoTexture(l);m.minFilter=THREE.LinearFilter,m.magFilter=THREE.LinearFilter,m.format=THREE.RGBFormat,m.wrapS=THREE.ClampToEdgeWrapping,m.wrapT=THREE.ClampToEdgeWrapping,n.map=m;var p=new THREE.MeshBasicMaterial({color:3355443}),c=new THREE.MeshPhongMaterial({color:16777215});c.specular.r=1,c.specular.g=1,c.specular.b=1,c.transparent=!0,c.opacity=.05,c.shininess=20,c.envMap=d,c.reflectivity=5,c.combine=THREE.MixOperation;var E=hexToRgb($(e).data("device-light")),w=hexToRgb($(e).data("device-dark"));if(console.log(E.r,w),$(e).hasClass("mobile")){var u,T,h;addPhone({x:de2ra(-35),z:de2ra(-20)},{y:23,x:8,z:0},n,c,s,w,E).done(function(e){TweenMax.to(e.rotation,1.5,{y:de2ra(0),ease:Power4.easeOut});TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});t.add(e),u=e}),addPhone({x:de2ra(-60),z:de2ra(20)},{x:-8,y:7,z:0},p,c,s,w,E).done(function(e){TweenMax.to(e.rotation,1.5,{y:de2ra(0),ease:Power4.easeOut});TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});t.add(e),T=e}),addPhone({x:de2ra(-65),z:de2ra(0)},{x:0,y:-12,z:0},p,c,s,w,E).done(function(e){TweenMax.to(e.rotation,1.5,{y:de2ra(0),ease:Power4.easeOut});TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});t.add(e),h=e})}else if($(e).hasClass("desktop")){var g=new THREE.Group,v=new THREE.Object3D,y=(new THREE.TextureLoader).load("models/macbook-texture.png");y.wrapS=THREE.RepeatWrapping,y.wrapT=THREE.RepeatWrapping,y.repeat.set(12,12);var R=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,color:16777215,metalness:.5,roughness:1,map:y,roughnessMap:y});s.load("models/screen-back.json",function(e,a){var i=new THREE.Mesh(e,R);i.position.y=0,i.position.x=-.5,i.position.z=0,i.castShadow=!0,i.traverse(function(e){v.add(i)})}),s.load("models/screen-front.json",function(e,a){var i=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,color:2236962,emissive:0,metalness:.7,roughness:.2,envMap:d}),o=new THREE.Mesh(e,i);o.position.y=0,o.position.x=-.5,o.position.z=0;o.castShadow=!0,v.add(o)});var H=new THREE.PlaneGeometry(8.7,5.8,1),M=new THREE.Mesh(H,n);M.position.z=-3.16,M.position.y=3.3,M.rotation.x=de2ra(1),v.add(M);var b=new THREE.Mesh(H,c);b.receiveShadow=!0,b.position.z=-3.16,b.position.y=3.3,b.rotation.x=de2ra(1),v.add(b);var x=new THREE.Object3D,f=new THREE.BoxBufferGeometry(200,200,200),z=new THREE.MeshBasicMaterial({color:16777215});mesh=new THREE.Mesh(f,z),v.position.z=3.1,x.add(v),x.position.z=-3,x.position.y=0,x.rotation.x=de2ra(90),g.add(x),s.load("models/keyboard.json",function(e,a){var i=new THREE.Mesh(e,R);i.position.x=-.5,i.castShadow=!0,console.log("material",R),g.add(i)}),s.load("models/keys.json",function(e,a){var o=new THREE.MultiMaterial(a),t=new THREE.Mesh(e,o);t.position.y=.005,t.position.x=-.5,t.position.z=0,t.castShadow=!0;var r={r:0,g:0,b:0},s=r;for(i=0;i<t.material.materials.length;i++){t.material.materials[i].side=THREE.DoubleSide,t.material.materials[i].specular.r=r.r/255,t.material.materials[i].specular.g=r.g/255,t.material.materials[i].specular.b=r.b/255,t.material.materials[i].emissive.r=s.r/255,t.material.materials[i].emissive.g=s.g/255,t.material.materials[i].emissive.b=s.b/255,t.material.materials[i].shininess=21}g.add(t)}),s.load("models/keys-top.json",function(e,a){var o=new THREE.MultiMaterial(a),t=new THREE.Mesh(e,o);t.position.y=.005,t.position.x=-.5,t.position.z=0,t.castShadow=!0;var r={r:15,g:15,b:15},s={r:25,g:25,b:25};for(i=0;i<t.material.materials.length;i++){t.material.materials[i].side=THREE.DoubleSide,t.material.materials[i].specular.r=r.r/255,t.material.materials[i].specular.g=r.g/255,t.material.materials[i].specular.b=r.b/255,t.material.materials[i].emissive.r=s.r/255,t.material.materials[i].emissive.g=s.g/255,t.material.materials[i].emissive.b=s.b/255,t.material.materials[i].shininess=21}g.add(t)}),g.position.x=20,g.position.y=-15,g.position.z=-5,g.rotation.x=de2ra(35),g.rotation.y=de2ra(-65),g.rotation.z=de2ra(40),g.scale.set(5,5,5),t.add(g),t.position.z=5,console.log("screenMaterial",n);TweenMax.to(g.position,3.5,{y:g.position.y-1,yoyo:!0,repeat:-1,ease:Power2.easeInOut,onComplete:function(){}}),TweenMax.to(x.rotation,2.5,{x:-de2ra(20),ease:Power4.easeInOut,delay:2})}return t.updatePosition=function(){this.position.x=this.count*screenWidthFromDistance(200)},t.start=function(){console.log("new section",e,$(e).attr("data-bg-light"),$(e).attr("data-bg-dark")),$("body").css("background",$(e).data("bg-dark"))},a.add(t),setTimeout(function(e){e.position.x=e.count*screenWidthFromDistance(200)},100,t),t}function addPhone(e,a,o,t,r,s,n){console.log("rotation",a);var l=new $.Deferred,d=new THREE.Group,m=new THREE.PlaneGeometry(.55,1,1),p=new THREE.Mesh(m,o);p.receiveShadow=!1,p.position.z=.0292,p.position.y=.05,d.add(p);var c=new THREE.Mesh(m,t);return c.receiveShadow=!1,c.position.z=.0292,c.position.y=.05,d.add(c),r.load("models/iphones7.json",function(o,t){var m=new THREE.MultiMaterial(t),p=new THREE.Mesh(o,m);p.position.y=-.6,p.castShadow=!0,p.receiveShadow=!0,d.add(p),p.traverse(function(e){for(e.geometry.computeFaceNormals(),d.position.y=-5,d.position.z=-1,i=0;i<p.material.materials.length;i++){p.material.materials[i].emissive.r=s.r/255,p.material.materials[i].emissive.g=s.g/255,p.material.materials[i].emissive.b=s.b/255,p.material.materials[i].color.r=n.r/255,p.material.materials[i].color.g=n.g/255,p.material.materials[i].color.b=n.b/255,p.material.materials[i].shininess=10}}),r.load("models/iphone-back.json",function(o,t){var r=new THREE.MultiMaterial(t),m=new THREE.Mesh(o,r);m.position.y=-.6,m.castShadow=!0,m.receiveShadow=!0,d.add(m),m.traverse(function(o){for(o.geometry.computeFaceNormals(),d.position.y=-5,d.position.z=-1,i=0;i<m.material.materials.length;i++){m.material.materials[i].emissive.r=s.r/255,m.material.materials[i].emissive.g=s.g/255,m.material.materials[i].emissive.b=s.b/255,m.material.materials[i].color.r=n.r/255,m.material.materials[i].color.g=n.g/255,m.material.materials[i].color.b=n.b/255}d.position.z=a.z,d.position.y=a.y,d.position.x=a.x,d.scale.set(30,30,30),d.castShadow=!0,d.rotation.x=e.x,d.rotation.z=e.z,l.resolve(d)})})}),l.promise()}
function init(){setEnvironment(),setLights(),$("section").each(function(e,n){sections.push(addProject(n,stage)),sections[e].count=e}),$("section:first-child").find("video")[0].play(),scrollHandler(),animate()}function setLights(){var e=1024,n=new THREE.PlaneGeometry(1650,1650,1),t=new THREE.ShadowMaterial;t.opacity=.1;var i=new THREE.Mesh(n,t);i.receiveShadow=!0,i.rotation.x=55,i.position.y=-30,i.transparent=!0,scene.add(i);var o=new THREE.AmbientLight(6710886);scene.add(o);var r=new THREE.SpotLight(16777215);r.shadow.mapSize.height=e,r.shadow.mapSize.width=e,r.castShadow=!1,r.position.set(0,55,0),r.intensity=.2,r.penumbra=1,r.decay=2,r.angle=.45,scene.add(r),scene.add(r.target);var a=new THREE.SpotLight(16777215);a.castShadow=!0,a.position.set(0,150,-0),a.target.position.set(0,0,0),a.shadow.mapSize.height=e,a.shadow.mapSize.width=e,a.intensity=.1,a.exponent=.05,a.penumbra=1,a.decay=2,a.angle=de2ra(80),scene.add(a),scene.add(a.target)}function scrollHandler(){scrollPercentage=$(".projects").scrollTop()/($(".projects")[0].scrollHeight-$(window).innerHeight()),activeSection=Math.floor(scrollPercentage*sections.length),activeSection==sections.length&&(activeSection-=1),activeSection!=prevActiveSection&&(console.log("starting section ",activeSection),sections[activeSection].start()),prevActiveSection=activeSection,stage.position.x=0-scrollPercentage*(screenWidthFromDistance(200)*(sections.length-1))}function setEnvironment(){var e=document.createElement("div");e.setAttribute("class","content"),document.getElementsByClassName("devices")[0].appendChild(e),camera=new THREE.PerspectiveCamera(setFOV(),window.innerWidth/window.innerHeight,1,5e3),camera.position.z=120,console.log(camera),scene=new THREE.Scene,stage=new THREE.Group,scene.add(stage),$(".projects").bind("scroll",scrollHandler);var n=!0;window.devicePixelRatio>1&&(n=!1),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:n}),renderer.setClearColor(16711680,0),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,e.appendChild(renderer.domElement);var t=renderer.domElement;t.style.position="absolute",window.addEventListener("resize",onWindowResize,!1),animate()}function onWindowResize(){for(windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),overlay.width=window.innerWidth,overlay.height=window.innerHeight,camera.fov=setFOV(),scrollHandler(),i=0;i<sections.length;i++)sections[i].updatePosition()}function onDocumentMouseMove(e){mouseX=windowHalfX-e.clientX,mouseY=windowHalfY-e.clientY,prevMouseX=mouseX,TweenMax.to(mousePosition,1,{x:mouseX,y:mouseY})}function animate(){requestAnimationFrame(animate),render()}function render(){camera.position.x=.003*(mousePosition.x-camera.position.x),camera.position.y=.003*(-mousePosition.y-camera.position.y),renderer.render(scene,camera)}function de2ra(e){return e*(Math.PI/180)}function screenWidthFromDistance(e){var n=window.innerWidth/window.innerHeight,t=2*e*Math.tan(.5*camera.fov*(Math.PI/180)),i=t*n;return i}function setFOV(){return fov=40,fov}function hexToRgb(e,n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),i=function(){return void 0==this.alpha?"rgb("+this.r+", "+this.g+", "+this.b+")":(this.alpha>1?this.alpha=1:this.alpha<0&&(this.alpha=0),"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")")};return void 0==n?t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),toString:i}:null:(n>1?n=1:0>n&&(n=0),t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),alpha:n,toString:i}:null)}function rgbToHex(e,n,t){function i(e){var n=e.toString(16);return 1==n.length?"0"+n:n}if(void 0==n||void 0==t){if("string"==typeof e){var o=/^rgb[a]?\(([\d]+)[ \n]*,[ \n]*([\d]+)[ \n]*,[ \n]*([\d]+)[ \n]*,?[ \n]*([.\d]+)?[ \n]*\)$/i.exec(e);return rgbToHex(parseInt(o[1]),parseInt(o[2]),parseInt(o[3]))}return void 0==e.r||void 0==e.g||void 0==e.b?null:rgbToHex(e.r,e.g,e.b)}var r=e;return"#"+i(r)+i(n)+i(t)}$(function(){init(),setTimeout(function(){$("video").each(function(){})},2e3)});var camera,scene,stage,renderer,mouseX=0,prevMouseX=0,mouseY=0,mouseDown=!1,mouseDirection,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,mouseDownCoord=new Object,sections=[],activeSection=0,prevActiveSection=null,background={light:{r:0,g:0,b:0},dark:{r:0,g:0,b:0}},mousePosition={x:0,y:0};document.addEventListener("mousemove",onDocumentMouseMove,!1),$(".controls a").click(function(e){e.stopPropagation()});
document.write('<script src="http://'+(location.host||"localhost").split(":")[0]+':35729/livereload.js?snipver=1"></script>');
function map_range(n,r,a,e,t){return e+(t-e)*(n-r)/(a-r)}
//# sourceMappingURL=site.js.map
