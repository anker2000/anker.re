function addPhone(e,a,o,s,r,t,n,l){var m=new $.Deferred,d=new THREE.Group,c=new THREE.PlaneGeometry(.55,1,1),p=new THREE.Mesh(c,o);p.receiveShadow=!1,p.position.z=.022,p.position.y=.05,d.add(p);var s=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,color:2236962,emissive:0,metalness:.7,roughness:.2,envMap:r}),E=new THREE.Mesh(c,s);return E.receiveShadow=!1,E.position.z=.022,E.position.y=.05,d.add(E),t.load("models/iphones7.json",function(o,s){var r=new THREE.MultiMaterial(s),c=new THREE.Mesh(o,r);c.position.y=-.6,c.castShadow=!0,c.receiveShadow=!0,d.add(c),c.traverse(function(e){for(d.position.y=-5,d.position.z=-1,i=0;i<c.material.materials.length;i++){c.material.materials[i].emissive.r=n.r/255,c.material.materials[i].emissive.g=n.g/255,c.material.materials[i].emissive.b=n.b/255,c.material.materials[i].color.r=l.r/255,c.material.materials[i].color.g=l.g/255,c.material.materials[i].color.b=l.b/255,c.material.materials[i].shininess=10}}),t.load("models/iphone-back.json",function(o,s){var r=new THREE.MultiMaterial(s),t=new THREE.Mesh(o,r);t.position.y=-.6,t.castShadow=!0,t.receiveShadow=!0,d.add(t),t.traverse(function(o){for(d.position.y=-5,d.position.z=-1,i=0;i<t.material.materials.length;i++){t.material.materials[i].emissive.r=n.r/255,t.material.materials[i].emissive.g=n.g/255,t.material.materials[i].emissive.b=n.b/255,t.material.materials[i].color.r=l.r/255,t.material.materials[i].color.g=l.g/255,t.material.materials[i].color.b=l.b/255}d.position.z=a.z,d.position.y=a.y,d.position.x=a.x,d.scale.set(30,30,30),d.castShadow=!0,d.rotation.x=e.x,d.rotation.y=e.y,d.rotation.z=e.z,m.resolve(d)})})}),m.promise()}function addLaptop(e,a,o,s,r,t,n,l){var m=new $.Deferred,d=new THREE.Group,c=new THREE.Object3D,p=(new THREE.TextureLoader).load("models/macbook-texture.png");p.wrapS=THREE.RepeatWrapping,p.wrapT=THREE.RepeatWrapping,p.repeat.set(12,12);var E=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,color:16777215,metalness:.5,roughness:1,map:p,roughnessMap:p}),w=new THREE.Object3D;return t.load("models/screen-back.json",function(n,l){var p=new THREE.Mesh(n,E);p.position.y=0,p.position.x=-.5,p.position.z=0,p.castShadow=!0,p.traverse(function(e){c.add(p)}),console.log("loaded screen back 1"),t.load("models/screen-front.json",function(n,l){var p=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,color:2236962,emissive:0,metalness:.7,roughness:.2,envMap:r}),E=new THREE.Mesh(n,p);E.position.y=0,E.position.x=-.5,E.position.z=0;var h={r:0,g:0,b:0};E.castShadow=!0,c.add(E);var u=new THREE.PlaneGeometry(8.7,5.8,1),v=new THREE.Mesh(u,o);v.position.z=-3.16,v.position.y=3.3,v.rotation.x=de2ra(1),c.add(v);var g=new THREE.Mesh(u,s);g.receiveShadow=!0,g.position.z=-3.16,g.position.y=3.3,g.rotation.x=de2ra(1),c.add(g);var T=new THREE.BoxBufferGeometry(200,200,200),R=new THREE.MeshBasicMaterial({color:16777215});mesh=new THREE.Mesh(T,R),c.position.z=3.1,w.add(c),w.position.z=-3,w.position.y=0,w.rotation.x=de2ra(90),d.add(w),console.log("loaded screen front 2"),t.load("models/keyboard.json",function(s,r){var n=new THREE.Mesh(s,p);n.position.x=-.5,n.castShadow=!0,console.log("material",p),d.add(n),console.log("loaded keyboard 3"),t.load("models/keys.json",function(s,r){var n=new THREE.MultiMaterial(r),l=new THREE.Mesh(s,n);l.position.y=.005,l.position.x=-.5,l.position.z=0,l.castShadow=!0;var c={r:0,g:0,b:0},p=c;for(i=0;i<l.material.materials.length;i++){l.material.materials[i].side=THREE.DoubleSide,l.material.materials[i].specular.r=c.r/255,l.material.materials[i].specular.g=c.g/255,l.material.materials[i].specular.b=c.b/255,l.material.materials[i].emissive.r=p.r/255,l.material.materials[i].emissive.g=p.g/255,l.material.materials[i].emissive.b=p.b/255,l.material.materials[i].shininess=21}d.add(l),console.log("loaded keys 4"),t.load("models/keys-top.json",function(s,r){var t=new THREE.MultiMaterial(r),n=new THREE.Mesh(s,t);n.position.y=.005,n.position.x=-.5,n.position.z=0,n.castShadow=!0;var l={r:15,g:15,b:15},c={r:25,g:25,b:25};for(i=0;i<n.material.materials.length;i++){n.material.materials[i].side=THREE.DoubleSide,n.material.materials[i].specular.r=l.r/255,n.material.materials[i].specular.g=l.g/255,n.material.materials[i].specular.b=l.b/255,n.material.materials[i].emissive.r=c.r/255,n.material.materials[i].emissive.g=c.g/255,n.material.materials[i].emissive.b=c.b/255,n.material.materials[i].shininess=21}d.scale.set(7.5,7.5,7.5),d.add(n),console.log(a),d.position.z=a.z,d.position.y=a.y,d.position.x=a.x,d.rotation.x=e.x,d.rotation.y=e.y,d.rotation.z=e.z,d.screen=w,console.log("screenMaterial",o);TweenMax.to(d.position,3.5,{y:d.position.y-1,yoyo:!0,repeat:-1,ease:Power2.easeInOut,onComplete:function(){}});console.log("loaded keys top 5"),d.begin=function(){console.log("macbook open");TweenMax.to(d.screen.rotation,1,{x:-de2ra(20),ease:Power4.easeInOut})},d.end=function(){TweenMax.to(d.screen.rotation,1,{x:de2ra(90),ease:Power4.easeInOut})},m.resolve(d)})})})})}),m.promise()}
function addProject(e,o){function n(){t.screenWidth=screenWidthFromDistance(camera.position.z),console.log(t.screenWidth)}var a=new THREE.Group,t={};$(window).bind("resize",n),n();var i=new THREE.JSONLoader,r=new THREE.MeshBasicMaterial({color:16777215}),d=$(e).find("video")[0],s=(new THREE.CubeTextureLoader).load(["models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg","models/environment2.jpg"]);s.format=THREE.RGBFormat;var c=new THREE.VideoTexture(d);c.minFilter=THREE.LinearFilter,c.magFilter=THREE.LinearFilter,c.format=THREE.RGBFormat,c.wrapS=THREE.ClampToEdgeWrapping,c.wrapT=THREE.ClampToEdgeWrapping,r.map=c;var l=new THREE.MeshBasicMaterial({color:3355443}),p=new THREE.MeshPhongMaterial({color:16777215});p.specular.r=1,p.specular.g=1,p.specular.b=1,p.transparent=!0,p.opacity=.05,p.shininess=20,p.envMap=s,p.reflectivity=5,p.combine=THREE.MixOperation;var m=hexToRgb($(e).data("device-light")),g=hexToRgb($(e).data("device-dark"));if(a.video=d,a.name=$(e).find("h2").html(),$(e).hasClass("mobile")){var u=new THREE.Group;addPhone({x:de2ra(60),y:de2ra(-140),z:de2ra(30)},{y:10,x:-10,z:-10},l,p,s,i,g,m).done(function(e){TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});u.add(e)}),addPhone({x:de2ra(50),y:de2ra(35),z:de2ra(-80)},{x:15,y:7,z:-10},r,p,s,i,g,m).done(function(e){TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});u.add(e)}),addPhone({x:de2ra(120),y:de2ra(0),z:de2ra(-60)},{x:45,y:-5,z:-10},l,p,s,i,g,m).done(function(e){TweenMax.to(e.position,3.5,{y:e.position.y-1,yoyo:!0,repeat:-1,delay:.5,ease:Power2.easeInOut,onComplete:function(){}});u.add(e)}),u.position.y=16,u.rotation.z=de2ra(-15),u.begin=function(){},u.end=function(){},a.add(u)}else $(e).hasClass("desktop")&&addLaptop({x:de2ra(35),y:de2ra(-65),z:de2ra(40)},{x:10,y:-20,z:-20},r,p,s,i,g,m).done(function(e){console.log("received macbook",e),a.add(e)});return a.updatePosition=function(){this.position.x=this.count*screenWidthFromDistance(200)},a.start=function(){a.video.play(),console.log("section",a),a.children[0].begin(),$("body").css("background",$(e).data("bg-dark")),$(".current_project *").css("color",$(e).data("text-color")),mainLight.color=rgbPercentage(hexToRgb($(e).data("bg-dark")));var o=colorIntensity(hexToRgb($(e).data("bg-light")));groundMaterial.opacity=map_range(o,0,1,.3,.05)},a.end=function(){"object"==typeof a.children[0]&&(a.children[0].end(),console.log(a))},o.add(a),setTimeout(function(e){e.position.x=e.count*screenWidthFromDistance(200)},100,a),a}
function init(){setEnvironment(),setLights(),$("section").each(function(e,n){sections.push(addProject(n,stage)),sections[e].count=e}),$("section:first-child").find("video")[0].play(),scrollHandler(),animate()}function setLights(){var e=512,n=new THREE.PlaneGeometry(1650,1650,1);groundMaterial=new THREE.ShadowMaterial,groundMaterial.opacity=.1;var i=new THREE.Mesh(n,groundMaterial);i.receiveShadow=!0,i.rotation.x=55,i.position.y=-50,i.transparent=!0,scene.add(i),mainLight=new THREE.AmbientLight({color:0,intensity:.02}),mainLight.intensity=.37,scene.add(mainLight);var t=new THREE.SpotLight(16777215);t.shadow.mapSize.height=e,t.shadow.mapSize.width=e,t.castShadow=!1,t.position.set(0,55,0),t.intensity=.2,t.penumbra=1,t.decay=2,t.angle=.45,scene.add(t),scene.add(t.target);var o=new THREE.SpotLight(16777215);o.castShadow=!0,o.position.set(0,150,20),o.shadow.mapSize.height=e,o.shadow.mapSize.width=e,o.intensity=.1,o.exponent=.05,o.penumbra=1,o.decay=2,o.angle=de2ra(80),o.target.position={x:0,y:0,z:-40},console.log(o),scene.add(o),scene.add(o.target)}function scrollHandler(){if(scrollPercentage=$(".projects").scrollTop()/($(".projects")[0].scrollHeight-$(window).innerHeight()),activeSection=Math.floor(scrollPercentage*sections.length),activeSection==sections.length&&(activeSection-=1),activeSection!=prevActiveSection)for(sections[activeSection].start(),i=0;i<sections.length;i++)i==activeSection?(console.log("starting section ",activeSection),sections[activeSection].start()):sections[i].end();prevActiveSection=activeSection;var e=0-scrollPercentage*(screenWidthFromDistance(200)*(sections.length-1));TweenMax.to(stage.position,.75,{ease:Power4.easeOut,x:e})}function setEnvironment(){var e=document.createElement("div");e.setAttribute("class","content"),document.getElementsByClassName("devices")[0].appendChild(e),camera=new THREE.PerspectiveCamera(setFOV(),window.innerWidth/window.innerHeight,1,5e3),camera.position.z=120,console.log(camera),scene=new THREE.Scene,stage=new THREE.Group,scene.add(stage),$(".projects").bind("scroll",scrollHandler);var n=!0;window.devicePixelRatio>1&&(n=!1),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:n}),renderer.setClearColor(16711680,0),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,e.appendChild(renderer.domElement);var i=renderer.domElement;i.style.position="absolute",window.addEventListener("resize",onWindowResize,!1),animate()}function onWindowResize(){for(windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),camera.fov=setFOV(),scrollHandler(),i=0;i<sections.length;i++)sections[i].updatePosition()}function onDocumentMouseMove(e){mouseX=windowHalfX-e.clientX,mouseY=windowHalfY-e.clientY,prevMouseX=mouseX,TweenMax.to(mousePosition,1,{x:mouseX,y:mouseY})}function animate(){requestAnimationFrame(animate),render()}function render(){camera.position.x=.003*(mousePosition.x-camera.position.x),camera.position.y=.003*(-mousePosition.y-camera.position.y),renderer.render(scene,camera)}function de2ra(e){return e*(Math.PI/180)}function screenWidthFromDistance(e){var n=window.innerWidth/window.innerHeight,i=1.75*e*Math.tan(.5*camera.fov*(Math.PI/180)),t=i*n;return t}function setFOV(){return fov=40,fov}$(function(){init(),setTimeout(function(){$("video").each(function(){})},2e3)});var camera,scene,stage,renderer,mouseX=0,prevMouseX=0,mouseY=0,mouseDown=!1,mouseDirection,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,mouseDownCoord=new Object,sections=[],activeSection=0,prevActiveSection=null,background={light:{r:0,g:0,b:0},dark:{r:0,g:0,b:0}},mainLight,groundMaterial,mousePosition={x:0,y:0};document.addEventListener("mousemove",onDocumentMouseMove,!1),$(".controls a").click(function(e){e.stopPropagation()});
document.write('<script src="http://'+(location.host||"localhost").split(":")[0]+':35729/livereload.js?snipver=1"></script>');
!function(n,e,t){"use strict";function o(n){n.each(function(n){var t=e.querySelectorAll(n.getSelectors()),o=n.getDeclaration();[].forEach.call(t,function(n){a(n,o)})})}function l(n){n.each(function(n){var t=e.querySelectorAll(n.getSelectors());[].forEach.call(t,function(n){r(n)})})}function a(n,t){if("undefined"!=typeof t["scroll-snap-coordinate"])return n.snapLengthUnit=x(t),i(n);var o=n.tagName;"body"!=o.toLowerCase()&&"html"!=o.toLowerCase()||(n=e),n.addEventListener("scroll",F,!1),"undefined"!=typeof t["scroll-snap-destination"]?n.snapLengthUnit=x(t):n.snapLengthUnit=p(t),n.snapElements=[]}function r(n){var t=n.tagName;"body"!=t.toLowerCase()&&"html"!=t.toLowerCase()||(n=e),n.removeEventListener("scroll",F,!1),n.snapLengthUnit=null,n.snapElements=[]}function i(n){for(var e=n;n&&n!==document;n=n.parentNode)"undefined"!=typeof n.snapElements&&n.snapElements.push(e)}function s(n,e,t){var o={y:d(e,e.snapLengthUnit.y),x:m(e,e.snapLengthUnit.x)},l=n.scrollTop,a=n.scrollLeft,r={y:l/o.y,x:a/o.x},i={y:H.y/o.y,x:H.x/o.x},s={y:0,x:0};s.y=c(t.y,r.y),s.x=c(t.x,r.x),s.y=f(i.y,r.y,s.y,H.y,l),s.x=f(i.x,r.x,s.x,H.x,a);var u={y:s.y*o.y,x:s.x*o.x};return u.y=y(0,h(n),u.y),u.x=y(0,v(n),u.x),u}function u(n,e,t){for(var o=e.snapElements.length,l=n.scrollTop,a=n.scrollLeft,r=Math.min(t.y,t.x),i={y:d(e,e.snapLengthUnit.y),x:m(e,e.snapLengthUnit.x)},s={y:0,x:0},u=k+r;u<o&&u>=0;u+=r)if(D=e.snapElements[u],s={y:D.offsetTop-n.offsetTop+d(D,D.snapLengthUnit.y),x:D.offsetLeft-n.offsetLeft+m(D,D.snapLengthUnit.x)},D.snapCoords=s,a<=s.x&&a+g(n)>=s.x&&l<=s.y&&l+L(n)>=s.y)return k=u,{y:y(0,h(n),s.y-i.y),x:y(0,v(n),s.x-i.x)};return 1==r&&u===o-1?(k=o-1,{y:y(0,h(n),s.y-i.y),x:y(0,v(n),s.x-i.x)}):r==-1&&0===u?(k=0,{y:y(0,h(n),s.y-i.y),x:y(0,v(n),s.x-i.x)}):{y:y(0,h(n),e.snapElements[k].snapCoords.y-i.y),x:y(0,v(n),e.snapElements[k].snapCoords.x-i.x)}}function c(n,e){return n===-1?Math.floor(e):Math.ceil(e)}function f(n,e,t,o,l){return Math.abs(n-e)>=b&&Math.abs(t-e)>T?Math.round(e):Math.abs(o-l)<N&&Math.abs(n-e)<b&&Math.abs(t-e)>w?Math.round(e):t}function y(n,e,t){return Math.max(Math.min(t,e),n)}function p(n){var e,t=/repeat\((\d+)(px|vh|vw|%)\)/g,o={y:{value:0,unit:"px"},x:{value:0,unit:"px"}};return"undefined"!==n["scroll-snap-points-y"]&&(e=t.exec(n["scroll-snap-points-y"]),null!==e&&(o.y={value:e[1],unit:e[2]})),"undefined"!==n["scroll-snap-points-x"]&&(e=t.exec(n["scroll-snap-points-x"]),null!==e&&(o.x={value:e[1],unit:e[2]})),o}function x(n){var e,t,o=/(\d+)(px|%) (\d+)(px|%)/g,l={y:{value:0,unit:"px"},x:{value:0,unit:"px"}};return"undefined"!=typeof n["scroll-snap-coordinate"]?e="scroll-snap-coordinate":"undefined"!=typeof n["scroll-snap-destination"]&&(e="scroll-snap-destination"),null!==e&&(t=o.exec(n[e]),null!==t&&(l.y={value:t[1],unit:t[2]},l.x={value:t[3],unit:t[4]})),l}function d(t,o){return"vh"==o.unit?Math.max(e.documentElement.clientHeight,n.innerHeight||1)/100*o.value:"%"==o.unit?L(t)/100*o.value:L(t)/o.value}function m(t,o){return"vw"==o.unit?Math.max(e.documentElement.clientWidth,n.innerWidth||1)/100*o.value:"%"==o.unit?g(t)/100*o.value:g(t)/o.value}function h(n){return n.scrollHeight}function v(n){return n.scrollWidth}function L(n){return n.offsetHeight}function g(n){return n.offsetWidth}function E(t){return t==e||t==n?e.documentElement.scrollTop>0||e.documentElement.scrollLeft>0?e.documentElement:e.querySelector("body"):t}function M(t,o){var l=Math.abs(t-o),a=100/Math.max(e.documentElement.clientHeight,n.innerHeight||1)*l,r=100/S*a;return isNaN(r)?0:Math.max(S/1.5,Math.min(r,S))}var T=1-.18,w=.95,N=5,b=2,U=45,S=768;if(!("scrollSnapType"in e.documentElement.style||"webkitScrollSnapType"in e.documentElement.style||"msScrollSnapType"in e.documentElement.style)){var C,q,A=null,H=null,F=function(n){C=n.target,q=E(C),P&&(cancelAnimationFrame(P)||clearTimeout(P)),A?clearTimeout(A):H={y:q.scrollTop,x:q.scrollLeft},A=setTimeout(W,U)},W=function(){if(H.y!=q.scrollTop||H.x!=q.scrollLeft){var n,e={y:H.y-q.scrollTop>0?-1:1,x:H.x-q.scrollLeft>0?-1:1};n="undefined"!=typeof q.snapElements&&q.snapElements.length>0?u(q,C,e):s(q,C,e),C.removeEventListener("scroll",F,!1),j(q,n,function(){C.addEventListener("scroll",F,!1)}),isNaN(n.x||!isNaN(n.y))||(H=n)}},D=null,k=0,R=function(n){return n*n*n},z=function(n,e,t,o){return t>o?e:n+(e-n)*R(t/o)},P=null,j=function(e,t,o){var l={y:e.scrollTop,x:e.scrollLeft},a=Date.now(),r=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(e){n.setTimeout(e,15)},i=Math.max(M(l.y,t.y),M(l.x,t.x)),s=function(){var n=Date.now()-a;if(isNaN(t.y)||(e.scrollTop=z(l.y,t.y,n,i)),isNaN(t.x)||(e.scrollLeft=z(l.x,t.x,n,i)),n>i){if("function"==typeof o)return o(t)}else P=r(s)};s()};new Polyfill({declarations:["scroll-snap-type:*","scroll-snap-point-y:*","scroll-snap-coordinate:*","scroll-snap-destination:*"]}).doMatched(o).undoUnmatched(l)}}(window,document);
function map_range(n,r,t,i,a){return i+(a-i)*(n-r)/(t-r)}function hexToRgb(n,r){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),i=function(){return void 0==this.alpha?"rgb("+this.r+", "+this.g+", "+this.b+")":(this.alpha>1?this.alpha=1:this.alpha<0&&(this.alpha=0),"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")")};return void 0==r?t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),toString:i}:null:(r>1?r=1:0>r&&(r=0),t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),alpha:r,toString:i}:null)}function rgbToHex(n,r,t){function i(n){var r=n.toString(16);return 1==r.length?"0"+r:r}if(void 0==r||void 0==t){if("string"==typeof n){var a=/^rgb[a]?\(([\d]+)[ \n]*,[ \n]*([\d]+)[ \n]*,[ \n]*([\d]+)[ \n]*,?[ \n]*([.\d]+)?[ \n]*\)$/i.exec(n);return rgbToHex(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]))}return void 0==n.r||void 0==n.g||void 0==n.b?null:rgbToHex(n.r,n.g,n.b)}var e=n;return"#"+i(e)+i(r)+i(t)}function rgbPercentage(n){return n.r=n.r/255,n.b=n.b/255,n.g=n.g/255,n}function colorIntensity(n){return console.log("intensity",n),(n.r/255+n.g/255+n.b/255)/3}
//# sourceMappingURL=site.js.map
