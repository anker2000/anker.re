var accordion=function(){function n(n){var c=$(n.target);c.parent().toggleClass("expand"),c.parent().is(".expand")}return{Init:function(){$(".accordion").each(function(){$(this).find(".accordionToggle").bind("click",n)})}}}();$(function(){accordion.Init()});
function buildItinerary(e){var t=document.location.hash.replace("#",""),r=entireJourney.outJourney;if("undefined"==typeof entireJourney.outJourney)return void(document.location.hash="/get_tickets/outbound/");var n='<ol><li class="outbound active">Outbound itinerary</li><li>Return itinerary</li></ol>';if("undefined"==typeof entireJourney.outJourney&&e&&(document.location.hash="/get_tickets/outbound/"),e||t.indexOf("outbound")>-1){journeyStops='<ul class="active"><li><p>Please make sure to arrive at the station well before your scheduled departure.</p><p><a href="#" onclick="return false" class="mapLink">Show directions to the coach station</a></p></li>';var o=pad(r.time,4),l=new Date(now.getMonth()+"/"+now.getDate()+"/"+now.getFullYear()+" "+o.substring(0,2)+":"+o.substring(2,4)+":00");for(i=0;i<r.leg.length;i++)for(a=0;a<r.leg[i].stop.length;a++){var s="stop",u="",c=new Date(l.getTime()+6e4*r.leg[i].stop[a].departure_time);if(0==a)s="stop newleg",u='<div class="carrier">'+r.leg[i].carrier+"</div>";else if(a==r.leg[i].stop.length-1){var c=new Date(l.getTime()+6e4*r.leg[i].stop[a].arrival_time);u="",s="stop endleg"}var o="<time>"+pad(c.getHours(),2)+":"+pad(c.getMinutes(),2)+"</time>";journeyStops+='<li class="'+s+'">'+o+r.leg[i].stop[a].city+u+"</li>",a==r.leg[i].stop.length-1&&i<r.leg.length-1&&(journeyStops+='<li class="layover">Layover in '+r.leg[i].stop[a].city+u+"</li>")}journeyStops+="</ul>",outJourneyHTML=journeyStops}if(r=entireJourney.returnJourney,e||t.indexOf("return")>-1){journeyStops='<ul><li><p>Please make sure to arrive at the station well before your scheduled departure.</p><p><a href="#" onclick="return false" class="mapLink">Show directions to the coach station</a></p></li>';var o=pad(r.time,4),l=new Date(now.getMonth()+"/"+now.getDate()+"/"+now.getFullYear()+" "+o.substring(0,2)+":"+o.substring(2,4)+":00");for(i=0;i<r.leg.length;i++)for(a=0;a<r.leg[i].stop.length;a++){var s="stop",u="",c=new Date(l.getTime()+6e4*r.leg[i].stop[a].departure_time);if(0==a)s="stop newleg",u='<div class="carrier">'+r.leg[i].carrier+"</div>";else if(a==r.leg[i].stop.length-1){var c=new Date(l.getTime()+6e4*r.leg[i].stop[a].arrival_time);u="",s="stop endleg"}var o="<time>"+pad(c.getHours(),2)+":"+pad(c.getMinutes(),2)+"</time>";journeyStops+='<li class="'+s+'">'+o+r.leg[i].stop[a].city+u+"</li>",a==r.leg[i].stop.length-1&&i<r.leg.length-1&&(journeyStops+='<li class="layover">Layover in '+r.leg[i].stop[a].city+u+"</li>")}journeyStops+="</ul>",returnJourneyHTML=journeyStops}e?$(".itinerary .container").html(n+outJourneyHTML+returnJourneyHTML+'<img src="img/itinerary-notes.png" width="100%">'):(console.log("check",outJourneyHTML),t.indexOf("outbound")>-1?$(".itineraryDrawer .container").html(outJourneyHTML+'<img src="img/itinerary-notes.png" width="100%">'):$(".itineraryDrawer .container").html(returnJourneyHTML+'<img src="img/itinerary-notes.png" width="100%">')),$(".itinerary .container ol li").bind("click",itineraryClickHandler)}function itineraryClickHandler(e){thisNo=$(e.target).index(),$(e.target).addClass("active").siblings().removeClass("active"),$(".itinerary .container ul").removeClass("active"),$(".itinerary .container ul:nth-of-type("+(thisNo+1)+")").addClass("active")}function openItineraryDrawer(e){var t=document.location.hash.replace("#","");t.indexOf("outbound")>-1?entireJourney.outJourney=$(e).closest("li")[0].journeyData:entireJourney.returnJourney=$(e).closest("li")[0].journeyData,buildItinerary(!1),$(".itineraryDrawer").addClass("active")}$(function(){$(".itineraryDrawer .close_button").bind("click",function(){$(".itineraryDrawer").toggleClass("active")})});
function getBusStops(){$.getJSON("feeds/"+busStopFile,{format:"json"},function(o){departure_data=o,globalJSON=o,busStopHandler(o,{},"type")}).done(function(){}).fail(function(o){console.log("error",o)})}function getJourneys(){$.getJSON("feeds/"+journeyFile,{format:"json"},function(o){departure_data=o,globalJSON=o,journeyHandler(o)}).done(function(){}).fail(function(o){console.log("error",o)})}function clone(o){if(null==o||"object"!=typeof o)return o;var n=o.constructor();for(var e in o)o.hasOwnProperty(e)&&(n[e]=o[e]);return n}var globalJSON,busStopFile="us-bus-stops.json?"+Math.random(),journeyFile="us-journey.json?"+Math.random();
function updateDatePickerCells(e){setTimeout(function(){$(".ui-datepicker td > *").each(function(e,t){var a=cellContents[e+1]||0,n="datepicker-content-"+CryptoJS.MD5(a).toString();0==a?addCSSRule(".ui-datepicker td a."+n+':after {content: "\\a0";}'):addCSSRule(".ui-datepicker td a."+n+':after {content: "'+a+'";}'),$(this).addClass(n)})},10)}function roundRange(){$(".ui-datepicker td.date-range-selected").each(function(e,t){0==e&&$(t).addClass("start"),e==$(".ui-datepicker td.date-range-selected").children().length-1&&""!=saveTheDate.returning&&$(t).addClass("end")})}function dateSingle(e){console.log("date Single"),direction="leaving",$(".search_drawer .date").toggleClass("show"),$(".search_drawer .date .direction .returning").removeClass("active"),$(".search_drawer .date .direction .leaving").addClass("active");var t=$(".ui-datepicker td a").width();$(".ui-datepicker td a, .ui-state-highlight").height(t),updateDatePickerCells()}function dateDouble(e){direction="returning",$(".search_drawer .date").toggleClass("show"),$(".search_drawer .date .direction .leaving").removeClass("active"),$(".search_drawer .date .direction .returning").addClass("active");var t=$(".ui-datepicker td a").width();$(".ui-datepicker td a, .ui-state-highlight").height(t),enableContinueButton()}function removeTodayHighlighting(){$(".ui-datepicker td").removeClass(" ui-datepicker-current-day, date-range-selected, ui-datepicker-current-day")}function enableContinueButton(){$(".container.cta button").removeClass("outofreach")}function calendarDirection(e){var t=e.target.parentNode;enableContinueButton(),$(t).hasClass("leaving")?(direction="leaving",$(".date .direction .returning").removeClass("active"),$(".date .direction .leaving").addClass("active")):(direction="returning",$(".date .direction .leaving").removeClass("active"),$(".date .direction .returning").addClass("active"))}function calendarContinue(){"leaving"==direction?($(".date .direction .leaving").removeClass("active"),$(".date .direction .returning").addClass("active"),direction="returning"):($(".search_drawer .date .close_button").trigger("click"),console.log("closing"))}var i=0,j,widthDate,cellContents=[],numberTraveller=1,numberCards=0,locateTarget=!1,direction="leaving",shortmonth=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekday=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],now=new Date;now.setHours(0),now.setMinutes(0),now.setSeconds(0);var sliderValues,saveTheDate={leaving:now,returning:""};$("#jrange.dates input.leaving").val("Today"),$(".date .direction .leaving .value").html("Today").addClass("validates");for(var cellContents=[],i=0;170>i;i++){var numberIsInArray=!1,rand=generateRandomNumb(34,42);cellContents.push("$"+rand)}var dynamicCSSRules=[];$(function(){$(".date .direction .leaving, .date .direction .returning").bind("click",calendarDirection);for(var e=0;170>e;e++){var t=generateRandomNumb(1,12);cellContents.push("Â£"+t)}$.datepicker._defaults.onAfterUpdate=null;var a=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(e){a.call(this,e);var t=this._get(e,"onAfterUpdate");t&&t.apply(e.input?e.input[0]:null,[e.input?e.input.val():"",e])};var n=-1,i=-1;$("#calendar").datepicker({numberOfMonths:4,changeMonth:!1,weekHeader:!1,dayNames:!1,firstDay:0,minDate:0,changeYear:!1,showButtonPanel:!0,beforeShowDay:function(e){return $("#calendar").is(".single")?[!0,e.getTime()==n?"date-range-selected":""]:[!0,e.getTime()>=Math.min(i,n)&&e.getTime()<=Math.max(i,n)?"date-range-selected":""]},onSelect:function(e,t,a){console.log(e);var r=new Date(e);e=weekday[r.getDay()]+" "+r.getDate()+" "+shortmonth[r.getMonth()],r.toString()==now.toString()?e="Today":console.log(r,now),"leaving"==direction?(n=new Date(t.selectedYear,t.selectedMonth,t.selectedDay).getTime(),saveTheDate.leaving=n,localStorage.setItem("leaving",e),$("#jrange input.singleB").val(e),$(".date .direction .leaving .value").html(e).addClass("validates"),""!=saveTheDate.returning?i=saveTheDate.returning:(i=n,$("td.ui-datepicker-current-day").removeClass("ui-datepicker-current-day"))):(n=new Date(t.selectedYear,t.selectedMonth,t.selectedDay).getTime(),saveTheDate.returning=n,localStorage.setItem("returning",e),$("#jrange input.returnB").val(e),$(".date .direction .returning .value").html(e).addClass("validates"),$("#jrange").parent().removeClass("alert"),i=""!=saveTheDate.leaving?saveTheDate.leaving:n),"undefined"!=typeof saveTheDate.returning&&""!=saveTheDate.returning&&(localStorage.setItem("saveTheDate",JSON.stringify(saveTheDate)),console.log("setting local storage",saveTheDate))},onAfterUpdate:function(e,t){var a=$(".ui-datepicker td a").width();$(".ui-datepicker td a, .ui-state-highlight").height(a),(""==saveTheDate.leaving||""==saveTheDate.returning)&&($("td.date-range-selected").removeClass("date-range-selected"),$("a.ui-state-active").parent().addClass("date-range-selected")),roundRange(),$('<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">Done</button>').appendTo($("#calendar .ui-datepicker-buttonpane")),updateDatePickerCells()}}).datepicker("setDate",null),updateDatePickerCells(),$(".ui-datepicker-today").trigger("click"),$("#jrange input").on("focus",function(e){var t,a=this.value;try{a.indexOf(" - ")>-1?(t=a.split(" - "),i=$.datepicker.parseDate("mm/dd/yy",t[0]).getTime(),n=$.datepicker.parseDate("mm/dd/yy",t[1]).getTime()):a.length>0&&(i=n=$.datepicker.parseDate("mm/dd/yy",a).getTime())}catch(e){n=i=-1}$("#calendar").datepicker("refresh").show(),n>-1?($("#calendar").datepicker("setDate",new Date(n)),console.log("1")):($("#calendar").datepicker("setDate",null).find(".date-range-selected").removeClass("date-range-selected, ui-datepicker-current-day"),removeTodayHighlighting(),console.log("2")),widthDate=$(".ui-datepicker td a").width(),$(".ui-datepicker td a,.ui-state-highlight").height(widthDate)})});
jQuery.extend(jQuery.easing,{def:"easeOutQuad",easeOutExpo:function(n,e,t,u,r){return e==r?t+u:u*(-Math.pow(2,-10*e/r)+1)+t},easeInOutQuad:function(n,e,t,u,r){return(e/=r/2)<1?u/2*e*e+t:-u/2*(--e*(e-2)-1)+t},easeOutElastic:function(n,e,t,u,r){var a=1.70158,i=0,f=u;if(0==e)return t;if(1==(e/=r))return t+u;if(i||(i=.3*r),f<Math.abs(u)){f=u;var a=i/4}else var a=i/(2*Math.PI)*Math.asin(u/f);return f*Math.pow(2,-10*e)*Math.sin((e*r-a)*(2*Math.PI)/i)+u+t}}),function(n){"object"==typeof exports?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(jQuery)}(function(n){n.extend({bez:function(e,t){if(n.isArray(e)&&(t=e,e="bez_"+t.join("_").replace(/\./g,"p")),"function"!=typeof n.easing[e]){var u=function(n,e){var t=[null,null],u=[null,null],r=[null,null],a=function(a,i){return r[i]=3*n[i],u[i]=3*(e[i]-n[i])-r[i],t[i]=1-r[i]-u[i],a*(r[i]+a*(u[i]+a*t[i]))},i=function(n){return r[0]+n*(2*u[0]+3*t[0]*n)},f=function(n){for(var e,t=n,u=0;++u<14&&(e=a(t,0)-n,!(Math.abs(e)<.001));)t-=e/i(t);return t};return function(n){return a(f(n),1)}};n.easing[e]=function(n,e,r,a,i){return a*u([t[0],t[1]],[t[2],t[3]])(e/i)+r}}return e}})});
function initiateTicketing(e,t){e.indexOf("outbound")>-1&&($(".ticket_finder")[0].className="outbound ticket_finder time"),e.indexOf("return")>-1&&($(".ticket_finder")[0].className="return ticket_finder time"),e.indexOf("summary")>-1&&($(".ticket_finder")[0].className="summary ticket_finder time",buildItinerary(!0));if(("undefined"==typeof saveTheDate.returning||""==saveTheDate.returning)&&(saveTheDate=JSON.parse(localStorage.getItem("saveTheDate"))),console.log("save the date",saveTheDate),$(".ticket_finder").hasClass("return"))var a=new Date(saveTheDate.returning);else var a=new Date(saveTheDate.leaving);console.log("Selected departure date",a),$(".ticket_finder .datepicker").html("");var n=864e5,r=priceDiff.length,s=(r-1)/2,l=new Date,c=Math.round(Math.abs((l.getTime()-a.getTime())/n)),o=0-s,d=!1;console.log("days until departure",c),s>c&&(o=0-c,d=!0),endDate=o+9;var u=0;for(i=o;i<endDate;i++){thisDate=addDays(a,i);var h=document.createElement("LI");0==i&&(h.className="highlight",d&&(h.className="highlight today")),h.innerHTML='<div class="date" data-date="'+thisDate.getTime()+'"><span class="datedate">'+weekday[thisDate.getDay()]+" "+thisDate.getDate()+" "+shortmonth[thisDate.getMonth()]+'</span><br/><span class="price" data-price="'+(basePrice+priceDiff[u])*numberTraveller+'">'+currency+(basePrice+priceDiff[u])*numberTraveller+"</span></div>",$(".ticket_finder .datepicker").append(h),u++}-1==e.indexOf("summary")&&grabScroller.Init($("ul.datepicker"))}function findTickets(){document.location.hash="/get_tickets/outbound/"}function showLoadingScreen(){$("content .loading_screen").addClass("active"),setTimeout(function(){$("content .loading_screen").removeClass("active")},3e3),setTimeout(function(){$(".message_bar").removeClass("loading")},5500)}function selectTicket(e){return thisTicket=$(e).closest("li"),$(".ticket_finder content .cards").animate({scrollTop:"0px"},300),currentPage.indexOf("/get_tickets/outbound/")>-1?(entireJourney.outJourney=thisTicket[0].journeyData,showLoadingScreen(),document.location.hash="/get_tickets/return/",$(".message_bar").addClass("loading"),setTimeout(loadReturnFile,1500),$(".out_bar time").html($(".datepicker .highlight .datedate").html()),$(".out_bar li:nth-child(2)").html(thisTicket.find(".deptime .left p").html()),$(".out_bar .price").html(thisTicket.find(".deptime .price").html()),!1):void(currentPage.indexOf("/get_tickets/return/")>-1&&(entireJourney.returnJourney=thisTicket[0].journeyData,document.location.hash="/get_tickets/summary/",setTimeout(function(){$(".message_bar").addClass("loading")},800),setTimeout(function(){$(".message_bar").removeClass("loading")},3e3),$(".return_bar time").html($(".datepicker .highlight .datedate").html()),$(".return_bar li:nth-child(2)").html(thisTicket.find(".deptime .left p").html()),$(".return_bar .price").html(thisTicket.find(".deptime .price").html()),$(".total .price").html(currency+(parseFloat($(".out_bar .price").html().replace(currency,""))+parseFloat($(".return_bar .price").html().replace(currency,"")))),$(".ticket_finder").removeClass("filtered"),$("#slider-range").slider("values",0,0),$(".range input#start").val("00:00"),$("#slider-range").slider("values",1,24),$(".range input#end").val('00:00 <span class="ampm">AM</span>')))}function outjourney(){document.location.hash="/get_tickets/outbound/",console.log("Outbound journey"),setTimeout(loadOutFile,1500),$(".ticket_finder content .cards").animate({scrollTop:"0px"},300),showLoadingScreen()}function returnjourney(){document.location.hash="/get_tickets/return/",console.log("Return journey"),setTimeout(loadReturnFile,1500),$(".ticket_finder content .cards").animate({scrollTop:"0px"},300),showLoadingScreen()}function scrollEndHandler(e){endObj=e,$(".datepicker li.highlight").removeClass("highlight"),$(".datepicker li:nth-child("+(e+1)+")").addClass("highlight"),$(".cards").css("opacity","0"),$(".cards ul li").removeClass("current push"),clearTimeout($.data(this,"scrollCheck")),$.data(this,"scrollCheck",setTimeout(function(){$(".cards").css("opacity","1");var t=priceDiff[e];$(".cards li").each(function(){var e=parseFloat($(this).find(".price").data("price"));$(this).find(".price").html(currency+numberTraveller*(e+t)).data("buyprice",numberTraveller*(e+t));var i=6e4*parseFloat($(this).find(".deptime").data("duration"));new Date($(".ticket_finder .datepicker li.highlight .date").data("date")+i)}).removeClass("show")},250))}function cardClickHandler(e){$(e.target).closest("li").toggleClass("show")}function americanTime(){var e=$("#start").val(),t=$("#end").val();$("#start").css("opacity",0),$("#end").css("opacity",0);var i=new Date(now.getMonth()+"/"+now.getDate()+"/"+now.getFullYear()+" "+e+":00"),a=new Date(now.getMonth()+"/"+now.getDate()+"/"+now.getFullYear()+" "+t+":00");$(".filter_drawer div.range > span").html("<time>"+formatAMPM(i,!0)+"</time><span>-</span><time>"+formatAMPM(a,!0)+"</time>")}var priceDiff=[-5,1,2,3,0,-1,-2,3,1],basePrice=35,entireJourney={},endObj;$("ul.datepicker").on("click","li.previous",function(){var e=$(this),t=(e.width(),$(".datepicker li").length,$(".datepicker li:nth-of-type(2)").width()),i=t*e.index()-t;$("ul.datepicker").animate({scrollLeft:i},150)}),$("ul.datepicker").on("click","li.next",function(){var e=$(this),t=(e.offset(),e.width(),$(".datepicker li").length,$(".datepicker li:nth-of-type(2)").width()),i=t*e.index()-t;$("ul.datepicker").animate({scrollLeft:i},500)}),$(function(){$(".initial h2").bind("click",function(){document.location.hash="/ticket_details/"}),$slide=$("#slider-range").slider({range:!0,min:0,max:24,values:[0,24],slide:function(e,t){t.values[0]<10?$("#start").val("0"+t.values[0]+":00"):$("#start").val(t.values[0]+":00"),t.values[1]<10?$("#end").val("0"+t.values[1]+":00"):$("#end").val(t.values[1]+":00"),americanTime(),doFilter()}}),setTimeout(americanTime,1e3),$(".toggle.direct").bind("click",doFilter),$("#start").val("0"+$("#slider-range").slider("values",0)+":00"),$("#end").val($("#slider-range").slider("values",1)+":00")});
var sortOptions="",dropDownHandler=function(){function t(t){var e=$(t.target).closest(".formDropdown");e.toggleClass("active"),$(document).bind("mouseup",function(t){"H4"==t.target.tagName&&"sortoptions"==t.target.parentNode.className?e.removeClass("active"):e.is(t.target)||0!==e.has(t.target).length||e.removeClass("active")})}function e(t){var e=$(t.target).closest(".formDropdown");sortOptions=e.find("input:checked").val(),value=e.find("input:checked + label p").html().toLowerCase(),e.find(".sortlabel").html(value),doFilter(),setTimeout(function(t){t.removeClass("active")},700,e)}return{Init:function(n){$(".formDropdown").each(function(){$(this).find("input[type=radio]").bind("click",e),$(this).find(".sortingby").bind("click",t)})}}}();$(function(){dropDownHandler.Init()});
function initMap(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(createMap,error)}function busStopHandler(e,t,n){return"undefined"==typeof e&&(e=globalJSON,"undefined"==typeof e)?!1:(busStops=TAFFY(e),busStops(t).each(function(e){if("A"==e.type)var t={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageCityBig,title:e.city,zIndex:2,type:e.type};else var t={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageCitySmall,title:e.city,zIndex:1,type:e.type};tempMarkers.push(t)}),setTimeout(function(){updateMarkers(),searchHandler.setupStations(),hashChangeHandler.Init()},2e3),void google.maps.event.addListener(map,"bounds_changed",boundsChangeHandler))}function boundsChangeHandler(){mapBounds=map.getBounds()}function updateMarkers(){if(!(document.location.hash.indexOf("ticket_details")>-1)){if(console.log("map bounds",mapBounds),"undefined"==typeof mapBounds)return boundsChangeHandler(),void setTimeout(updateMarkers,1e3);var e=searchHandler.getJourney();markers.length>0&&clearMarkers();var t=4;switch(map.zoom){case 5:t=2.4;break;case 6:t=1.2;break;case 7:t=.4;break;case 8:t=.2}var n=tempMarkers,o=[],s=[];for(console.log(initBounds),lng=-123.111;lng<=-70;lng+=t)for(lat=27;lat<=45;lat+=t){for(o=[],i=0;i<n.length;i++)n[i].position.lng>=lng&&n[i].position.lng<lng+t&&n[i].position.lat>=lat&&n[i].position.lat<lat+t&&o.push(n[i]);o.length>0&&s.push(o.splice(0))}for(i=0;i<s.length;i++)if(o=s[i].splice(0),o.length>1&&map.zoom<8){var l=0,r=0,p=0,g=0,m=0;for(a=0;a<o.length;a++)if(p+=o[a].position.lat,g+=o[a].position.lng,o[a].title!=e.begin&&o[a].title!=e.end)2==o[a].zIndex&&(l=o[a].position.lat,r=o[a].position.lng,m++);else{var u=[];o[a].title==e.begin?o[a].targetInput=$(".journey input[tabindex=1]"):o[a].title==e.end&&(o[a].targetInput=$(".journey input[tabindex=2]")),u.push(o[a]),s.push(u),o.splice(a,1),a--}1!=m&&(l=p/o.length,r=g/o.length);var d={lat:l,lng:r},c=d.lat>=mapBounds.f.f&&d.lat<=mapBounds.f.b,y=d.lng<=mapBounds.b.f&&d.lng>=mapBounds.b.b,f=0;c&&y||(f=2e3),setTimeout(function(e,t){var n=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:map,icon:imageCityCluster,title:t,labelClass:"labels",type:"cluster",zIndex:2}),o=new google.maps.InfoWindow({content:'<div class="labelHook">'+t+"</div>",disableAutoPan:!0});o.open(map,n),setTimeout(function(){$(".labelHook").each(function(){var e=$(this).html();$(this).parent().parent().parent().parent().html(e).addClass("groupLabel")})},100),markers.push(n),google.maps.event.addListener(n,"click",function(){setTimeout(clearMarkers,200),setTimeout(function(){map.setZoom(map.zoom+1)},400,n),map.panTo(new google.maps.LatLng(this.position.lat(),this.position.lng()))})},f,d,o.length.toString())}else for(a=0;a<o.length;a++){o[a].title==e.begin?o[a].targetInput=$(".journey input[tabindex=1]"):o[a].title==e.end&&(o[a].targetInput=$(".journey input[tabindex=2]"));var d={lat:l,lng:r},c=o[a].position.lat>=mapBounds.f.f&&o[a].position.lat<=mapBounds.f.b,y=o[a].position.lng<=mapBounds.b.f&&o[a].position.lng>=mapBounds.b.b,f=0;c&&y||(f=3e3),setTimeout(function(t){var n=new google.maps.Marker(t);markers.push(n),google.maps.event.addListener(n,"click",function(e){$(".station_info").removeClass("expanded"),this.getIcon().url!=imageCityDisabled.url&&("undefined"==typeof this.labelElm&&(this.labelElm=$('.cityLabel h3:contains("'+this.title+'")').parent().parent()),this.labelElm.trigger("mouseout"),$(".journey").removeClass("expanded"),searchHandler.fillInCity(this),clearTimeout(this.timeout))}),(t.title==e.begin||t.title==e.end)&&setTimeout(function(e,t){searchHandler.setElementFocus(t),google.maps.event.trigger(e,"click"),searchHandler.setElementFocus(t)},300,n,t.targetInput),google.maps.event.addListener(n,"mouseover",function(e){this.getIcon().url!=imageCityDisabled.url&&"undefined"==typeof this.labelElm&&(this.labelElm=$('.cityLabel h3:contains("'+this.title+'")').parent().parent())}),n.cityWindow=new google.maps.InfoWindow({content:'<div class="labelCityHook"><div class="labelbg"></div><div class="label'+t.zIndex+'"><h3>'+t.title+'</h3><a href="#/station_info/'+t.title+'">Show stop details</a></div></div>',disableAutoPan:!0}),n.cityWindow.open(map,n),setTimeout(function(e){$('.labelCityHook h3:contains("'+e.title+'")').each(function(){var t=$(this).parent().parent().html(),n=$(this).parent().parent().parent().parent().parent().parent();$(".label1",$(this)).length>0?n.html(t).addClass("cityLabel").addClass("small"):n.html(t).addClass("cityLabel"),n.bind("mouseover",function(){if(this.marker.getIcon().url!=imageCityDisabled.url){"undefined"==typeof this.zIndex&&(this.zIndex=$(this).parent().css("z-index")),$(this).parent().css("z-index",1e5);var e=searchHandler.getJourney().begin;"undefined"==typeof e||$(".journey input[tabindex=1]").hasClass("active")||(drawJourney({begin:e,end:this.marker.title}),clearTimeout(this.timeout))}}),n.bind("mouseout",function(){this.marker.getIcon().url!=imageCityDisabled.url&&(this.timeout=setTimeout(undrawJourney,100),$(this).parent().css("z-index",this.zIndex))}),n.bind("click",function(e){$(".station_info").removeClass("expanded"),this.marker.getIcon().url!=imageCityDisabled.url&&"A"!==e.target.tagName&&google.maps.event.trigger(this.marker,"click",e)}),n[0].marker=e})},250,n)},f,o[a])}}}function getCurrentBounds(){return map.getBounds()}function journeyHandler(e){return"undefined"==typeof e&&(e=globalJSON,"undefined"==typeof e)?!1:void(journey=TAFFY(e))}function drawJourney(e){"undefined"!=typeof poly&&poly.setMap(null);var t={path:"M 0,-1 0,1",strokeOpacity:1,scale:3,strokeWeight:2.2,strokeColor:"#aaaaaa"};poly=new google.maps.Polyline({strokeOpacity:0,strokeWeight:2,icons:[{icon:t,offset:"0",repeat:"15px"}],zIndex:10,map:map});var n=$('.cityLabel h3:contains("'+e.begin+'")').parent().parent(),o=$('.cityLabel h3:contains("'+e.end+'")').parent().parent(),a=[n[0].marker.getPosition()];journey({from:e.begin},{to:e.end}).each(function(e){if("undefined"!=typeof e.stops)for(i=0;i<e.stops.length;i++)busStops({city:e.stops[i].city}).each(function(e){var t={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageEnRoute,title:e.city,zIndex:3,type:e.type},n=new google.maps.Marker(t);journeyMarkers.push(n),a.push(n.getPosition())})}),a.push(o[0].marker.getPosition()),poly.setPath(a)}function drawFinalJourney(e){var t=new google.maps.LatLngBounds;"undefined"!=typeof poly&&poly.setMap(null),poly=new google.maps.Polyline({strokeOpacity:1,strokeWeight:2,strokeColor:"#cccccc",zIndex:10,map:map});var n=[];"undefined"==typeof e.begin&&(e={begin:"New York",end:"Washington DC"}),busStops({city:e.begin}).each(function(e){var o={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageBusStop,title:e.city,zIndex:3,type:e.type},a=new google.maps.Marker(o);journeyMarkers.push(a),n.push(a.getPosition()),t.extend(a.getPosition()),a.cityWindow=new google.maps.InfoWindow({content:'<div class="labelCityHook"><div class="labelbg"></div><div class="label'+a.zIndex+'"><h3>'+a.title+"</h3></div></div>",disableAutoPan:!0}),a.cityWindow.open(map,a),setTimeout(function(e){$('.labelCityHook h3:contains("'+e.title+'")').each(function(){var e=$(this).parent().parent().html(),t=$(this).parent().parent().parent().parent().parent().parent();t.html(e).addClass("cityLabel").addClass("show")})},300,a)}),journey({from:e.begin},{to:e.end}).each(function(e){if("undefined"!=typeof e.stops)for(i=0;i<e.stops.length;i++)busStops({city:e.stops[i].city}).each(function(e){var o={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageEnRoute,title:e.city,zIndex:3,type:e.type},a=new google.maps.Marker(o);journeyMarkers.push(a),n.push(a.getPosition()),t.extend(a.getPosition())})}),busStops({city:e.end}).each(function(e){var o={position:{lat:e.latitude,lng:e.longitude},map:map,icon:imageBusStop,title:e.city,zIndex:3,type:e.type},a=new google.maps.Marker(o);journeyMarkers.push(a),n.push(a.getPosition()),t.extend(a.getPosition()),a.cityWindow=new google.maps.InfoWindow({content:'<div class="labelCityHook"><div class="labelbg"></div><div class="label'+a.zIndex+'"><h3>'+a.title+"</h3></div></div>",disableAutoPan:!0}),a.cityWindow.open(map,a),setTimeout(function(e){$('.labelCityHook h3:contains("'+e.title+'")').each(function(){var e=$(this).parent().parent().html(),t=$(this).parent().parent().parent().parent().parent().parent();t.html(e).addClass("cityLabel").addClass("show")})},300,a)});var o=new google.maps.LatLng(t.getNorthEast().lat()+1.5,t.getNorthEast().lng()),a=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()-2.5);t.extend(o),t.extend(a),map.fitBounds(t),setTimeout(offsetCenter,300),setTimeout(clearMarkers,500),setTimeout(function(e,t,n){e.setPath(t)},1e3,poly,n,journeyMarkers)}function offsetCenter(){var e=map.getCenter(),t=.4;switch(parseInt(map.zoom)){case 6:t=-3;break;case 7:t=-1.4;break;case 8:t=-.2}map.panTo(new google.maps.LatLng(e.lat(),e.lng()+t))}function repositionMapToJourney(){console.log("repositioning");var e=!0,t=new google.maps.LatLngBounds,n=searchHandler.getJourneyInformation();journey({from:n.start.name},{to:n.end.name}).each(function(n){if("undefined"!=typeof n.stops)for(i=0;i<n.stops.length;i++)busStops({city:n.stops[i].city}).each(function(n){thisBound=new google.maps.LatLng(n.latitude,n.longitude),mapBounds.contains(thisBound)||(e=!1,console.log(n.name,"is outside")),t.extend(thisBound)})}),t.extend(n.start.marker.getPosition()),t.extend(n.end.marker.getPosition()),mapBounds.contains(n.start.marker.getPosition())&&mapBounds.contains(n.end.marker.getPosition())||(e=!1);var o=new google.maps.LatLng(t.getNorthEast().lat()+1.15,t.getNorthEast().lng()+1.15),a=new google.maps.LatLng(t.getSouthWest().lat()-1.15,t.getSouthWest().lng()-1.15);t.extend(o),t.extend(a),e||(setTimeout(function(){map.fitBounds(t)},400),setTimeout(function(){var e=map.getCenter(),t=.4;switch(parseInt(map.zoom)){case 6:t=-3;break;case 7:t=-1.4;break;case 8:t=-.2}map.panTo(new google.maps.LatLng(e.lat(),e.lng()+t))},1e3))}function undrawJourney(){"undefined"!=typeof poly&&poly.setMap(null);for(var e=0;e<journeyMarkers.length;e++)journeyMarkers[e].setMap(null)}function mapZoomHandler(){console.log("zoom level",map.zoom),searchHandler.setElementFocus($(".journey input[tabindex=1]"));var e=map.zoom>prevZoom;clearMarkers(e),ticketLockedIn||setTimeout(updateMarkers,1e3)}function createMap(e){console.log("current location",e),map=new google.maps.Map(document.getElementsByClassName("bgmap")[0],{center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:zoomLevel,styles:customStyles,disableDefaultUI:!1,mapTypeControl:!1,scaleControl:!0,scrollwheel:!1}),getBusStops(),getJourneys(),google.maps.event.addListener(map,"zoom_changed",mapZoomHandler),map.addListener("click",closeDrawers),map.addListener("dragstart",closeDrawers),map.addListener("dblclick",closeDrawers)}function disableUnavailableDestinations(e){destinationsDisabled=!0,console.log(e),setTimeout(function(e){var t=[];for(console.log(journey()),journey({from:e.start.name}).each(function(e){if(console.log("journey",e),"undefined"!=typeof e.stops)for(i=0;i<e.stops.length;i++)t.push(e.stops[i].city);t.push(e.from),t.push(e.to)}),i=0;i<markers.length;i++)if(-1==t.indexOf(markers[i].title)&&markers[i].getIcon().url!=imageCitySelected.url&&"cluster"!=markers[i].type)markers[i].setIcon(imageCityDisabled);else if(markers[i].getIcon().url!=imageCitySelected.url)switch(markers[i].type){case"A":markers[i].setIcon(imageCityBig);break;case"B":markers[i].setIcon(imageCitySmall)}},20,e)}function enableAllDestinations(){if(destinationsDisabled){for(i=0;i<markers.length;i++)switch(markers[i].type){case"A":markers[i].setIcon(imageCityBig);break;case"B":markers[i].setIcon(imageCitySmall)}destinationsDisabled=!1}}function error(e){console.log("error",e),console.log("defaulting to Huge Brooklyn office location");var t={};t.coords={},t.coords.latitude=40.7028856,t.coords.longitude=-73.9926274,createMap(t)}function clearMarkers(e){setMapOnAll(null,e),markers=[]}function setMapOnAll(e,t){for(var n=0;n<markers.length;n++){var o=markers[n].position.lat()>=mapBounds.f.f&&markers[n].position.lat()<=mapBounds.f.b,a=markers[n].position.lng()<=mapBounds.b.f&&markers[n].position.lng()>=mapBounds.b.b;o&&a||!t?markers[n].setMap(e):setTimeout(function(t){t.setMap(e)},4e3,markers[n])}}function openStationInfo(e){$(".station_info").addClass("expanded"),busStops({city:e}).each(function(t){if($(".station_info .active").removeClass("active"),$(".station_info .stations ul").html(" "),"undefined"!=typeof t.stations)for($(".station_info .stations").addClass("active"),i=0;i<t.stations.length;i++){var n=document.createElement("LI");n.innerHTML=e+", "+t.stations[i].city,n.addEventListener("click",function(){openStationMap(t)}),$(".station_info .stations ul").append(n)}else openStationMap(t)})}function openStationMap(e){$(".station_info .active").removeClass("active"),$(".station_info .info").addClass("active");var t=new google.maps.Map(document.getElementsByClassName("stationmap")[0],{center:{lat:e.latitude,lng:e.longitude},zoom:16,styles:customStyles,disableDefaultUI:!0,mapTypeControl:!1,scaleControl:!1});"undefined"!=typeof station_marker&&station_marker.setMap(null),station_marker=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:t,icon:imageBusStop,title:e.city,labelClass:"labels",zIndex:2}),$(".station_info div.address .location").html(e.city),$(".station_info div.address .address_street").html("5 Main St, NX 123, "+e.country)}function closeDrawers(){var e=document.location.hash.replace("#","");-1==e.indexOf("/ticket_details/")?(setTimeout(function(){$(".station_info .active").removeClass("active")},400),$(".expanded").removeClass("expanded"),document.location.hash=""):$(".station_info").removeClass("expanded")}var apiKey="AIzaSyCHh4oobxVPkxm0NuPSpusns3QNe9ZdJHU",map,tempMarkers=[],markers=[],infoCloseTimeout,activeInfo,zoomLevel=7,prevZoom=7,busStops,journey,poly,tripLockedIn=!1,mapBounds,destinationsDisabled=!1,initBounds={SW:{lat:45,lng:-123},NE:{lat:27,lng:-70}},customStyles=[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"on"},{color:"#cccccc"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#eeeeee"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#ffda86"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#9edbf7"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],imageCitySelected={url:"img/maps_marker-city-selected.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageCityBig={url:"img/maps_marker-city-big.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageCitySmall={url:"img/maps_marker-city-small.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageCityDisabled={url:"img/maps_marker-city-disabled.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageEnRoute={url:"img/maps_marker-city-enroute.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageCityCluster={url:"img/maps_marker-cluster.svg",size:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)},imageBusStop={url:"img/maps_marker-busstop.svg",size:new google.maps.Size(50,70),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,68)};initMap();var journeyMarkers=[],station_marker;
var grabScroller=function(){function n(n){var o=l-n.pageX;$(e).scrollLeft(o+t),d=!0}function o(n){console.log("snap to nearest",n);var o=Math.round($(e).scrollLeft()/i),l=o*i;return $(e).animate({scrollLeft:l},400),r=o,o}var e,i,r,l=0,t=0,d=!1;return{Init:function(r){e=r[0],i=$(e).find("li:first-child").width(),r.unbind("mousedown"),$("body").unbind("movemove").unbind("mouseup"),r.bind("mousedown",function(e){d=!1,l=e.pageX,t=$(this).scrollLeft(),$("body").bind("mousemove",n),$(r).find("li").bind("mouseup",function(){d||grabScroller.scrollTo($(this).index()*i)}),$("body").bind("mouseup",function(e){if($("body").unbind("mousemove",n),$("body").unbind("mouseup"),d){var i=o();scrollEndHandler(i)}})});var u=r.children().length,c=r.find(".today").index();-1==c&&(c=(u-1)/2),console.log(r,u,c),grabScroller.scrollTo(c*i)},scrollTo:function(n){var o=Math.round(n/i),r=o*i;$(e).animate({scrollLeft:r},300,function(){scrollEndHandler(o)})},getPosition:function(){return"undefined"!=typeof e?r:5}}}();
var currentPage,hashChangeHandler=function(){function e(){ticketLockedIn=!1;var e=document.location.hash.replace("#","");if(console.log("location hash",e),currentPage=e,$("div.cards").css("opacity",""),e.indexOf("/station_info/")>-1&&(e=e.replace("/station_info/",""),openStationInfo(e)),e.indexOf("/ticket_details/")>-1?(tripLockedIn=!0,$(".ticket_details").addClass("enabled"),window.requestAnimationFrame(function(){drawFinalJourney(searchHandler.getJourney())}),closeDrawers(),$(".ticket_finder").removeClass("outbound return summary")):($(".ticket_details").removeClass("enabled"),undrawJourney(),t.indexOf("/ticket_details/")>-1&&updateMarkers()),e.indexOf("/get_tickets/")>-1){$("body").addClass("tickets"),$("div.cards").css("opacity",null),t.indexOf("/ticket_details/")>-1&&setTimeout(showLoadingScreen,900);var i=2e3;t.indexOf("/get_tickets/")>-1&&(i=0),setTimeout(function(e,t){initiateTicketing(e,-1==t.indexOf("/get_tickets/"))},i,e,t)}else $("body").removeClass("tickets");t=e}var t="";return{Init:function(){$(window).bind("hashchange",e),e()}}}();
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=s(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,n)}function n(){t.datepicker._isDisabledDatepicker(h.inline?h.dpDiv.parent()[0]:h.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function o(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{};var r=(t.ui.version="1.12.0-rc.2",0),l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(o){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,a,o,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],a=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new a(t,e)},t.extend(a,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),o=new i,o.options=t.widget.extend({},o.options),t.each(s,function(e,s){return t.isFunction(s)?void(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=a,e}}()):void(r[e]=s)}),a.prototype=t.widget.extend(o,{widgetEventPrefix:n?o.widgetEventPrefix||e:e},r,{constructor:a,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,a,i._proto)}),delete n._childConstructors):i._childConstructors.push(a),t.widget.bridge(e,a),a},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t.isPlainObject(s)?e[i]=t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):e[i]=s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var a="string"==typeof n,o=l.call(arguments,1),r=this;return a?this.each(function(){var i,a=t.data(this,s);return"instance"===n?(r=a,!1):a?t.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):(o.length&&(n=t.widget.extend.apply(null,[n].concat(o))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,a,o=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(o={},s=e.split("."),e=s.shift(),s.length){for(n=o[e]=t.widget.extend({},this.options[e]),a=0;a<s.length-1;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=i}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,a){var o,r;for(r=0;r<i.length;r++)o=n.classesElementLookup[i[r]]||t(),o=t(e.add?t.unique(o.get().concat(e.element.get())):o.not(e.element).get()),n.classesElementLookup[i[r]]=o,s.push(i[r]),a&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,a={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return a.element.toggleClass(this._classes(a),s),this},_on:function(e,i,s){var n,a=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,o){function r(){return e||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+a.eventNamespace,u=l[2];u?n.on(h,u,r):i.on(h,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,a,o=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(t.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),o=!t.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){t(this)[e](),a&&a.call(s[0]),i()})}});t.widget,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}};"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,a){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),a&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?o["inner"+i].call(this):this.each(function(){t(this).css(a,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?o["outer"+i].call(this,e):this.each(function(){t(this).css(a,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))});t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,a;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),a=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(a.find(i).addBack(i))),this.pushStack(n))},t.widget("ui.controlgroup",{version:"1.12.0-rc.2",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var a,o={};return n?"controlgroupLabel"===s?(a=e.element.find(n),a.each(function(){t(this).contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(a,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(a.get()))):void(t.fn[s]&&(e["_"+s+"Options"]&&(o=e["_"+s+"Options"]("middle")),e.element.find(n)[s](o).each(function(){var e=t(this),n=e[s]("widget");t.data(n[0],"ui-controlgroup-data",e[s]("instance")),i.push(n[0])}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:null,first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right")}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":null,"ui-selectmenu-button-closed":null},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?null:"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")}}[t]}},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");n&&i["_"+n.widgetName+"Options"]?n.element[n.widgetName](i["_"+n.widgetName+"Options"](s)):i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}});t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.0-rc.2",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-highlight",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-highlight":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-highlight"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){this.label.contents().not(this.element.add(this.icon).add(this.iconSpace)).remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]);t.ui.checkboxradio;t.widget("ui.button",{version:"1.12.0-rc.2",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,a="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),a?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))});t.ui.button;t.extend(t.ui,{datepicker:{version:"1.12.0-rc.2"}});var h;t.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,a;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),a=this._newInst(t(e),n),a.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,a):n&&this._inlineDatepicker(e,a)},_newInst:function(e,i){var n=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?s(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=t("<span class='"+this._appendClass+"'>"+o+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(a?t("<img/>").attr({src:a,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,a=new Date(2009,11,20),o=this._get(t,"dateFormat");o.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length,s=n);return s},a.setMonth(e(this._get(t,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(e(this._get(t,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),t.input.attr("size",this._formatDate(t,a).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,l,h,u,c,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+u,h/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),h===n&&(h=null))},_enableDatepicker:function(e){var i,s,n=t(e),a=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),a=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]===t)return!0;
return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,l,h=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):h?"all"===i?t.extend({},h.settings):this._get(h,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),void(h&&(this._curInst===h&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),a(h.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(h.settings.minDate=this._formatDate(h,r)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),h),this._autoSize(h),this._setDate(h,o),this._updateAlternate(h),this._updateDatepicker(h))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,a=t.datepicker._getInst(e.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),o=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",a.dpDiv),n[0]&&t.datepicker._selectDay(e.target,a.selectedMonth,a.selectedYear,n[0]),i=t.datepicker._get(a,"onSelect"),i?(s=t.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),o=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),o=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),o=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),o=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),o=e.ctrlKey||e.metaKey;break;default:o=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):o=!1;o&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(i){if(i=i.target||i,"input"!==i.nodeName.toLowerCase()&&(i=t("input",i.parentNode)[0]),!t.datepicker._isDisabledDatepicker(i)&&t.datepicker._lastInput!==i){var s,n,o,r,l,h,u;s=t.datepicker._getInst(i),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(i,[i,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=i,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(i.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(i),t.datepicker._pos[1]+=i.offsetHeight),r=!1,t(i).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),l=t.datepicker._checkOffset(s,l,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),s.inline||(h=t.datepicker._get(s,"showAnim"),u=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",e(t(i))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?s.dpDiv.show(h,t.datepicker._get(s,"showOptions"),u):s.dpDiv[h||"show"](h?u:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))}},_updateDatepicker:function(e){this.maxRows=4,h=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),a=s[1],o=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&n.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),a>1&&e.dpDiv.addClass("ui-datepicker-multi-"+a).css("width",o*a+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),a=e.dpDiv.outerHeight(),o=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-o:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+a>h&&h>a?Math.abs(a+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,a,o=this._curInst;!o||e&&o!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){t.datepicker._tidyDialog(o)},t.effects&&(t.effects.effect[i]||t.effects[i])?o.dpDiv.hide(i,t.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(e,i,s,n){var a,o=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=t("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(e,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,a=this._get(e,"altField");a&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(a).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?i.toString():i+"",""===i)return null;var n,a,o,r,l=0,h=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),c=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,g=(s?s.monthNames:null)||this._defaults.monthNames,_=-1,m=-1,f=-1,v=-1,b=!1,k=function(t){var i=n+1<e.length&&e.charAt(n+1)===t;return i&&n++,i},y=function(t){var e=k(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,a=new RegExp("^\\d{"+n+","+s+"}"),o=i.substring(l).match(a);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},D=function(e,s,n){var a=-1,o=t.map(k(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(o,function(t,e){var s=e[1];return i.substr(l,s.length).toLowerCase()===s.toLowerCase()?(a=e[0],l+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+l},w=function(){if(i.charAt(l)!==e.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;n<e.length;n++)if(b)"'"!==e.charAt(n)||k("'")?w():b=!1;else switch(e.charAt(n)){case"d":f=y("d");break;case"D":D("D",c,d);break;case"o":v=y("o");break;case"m":m=y("m");break;case"M":m=D("M",p,g);break;case"y":_=y("y");break;case"@":r=new Date(y("@")),_=r.getFullYear(),m=r.getMonth()+1,f=r.getDate();break;case"!":r=new Date((y("!")-this._ticksTo1970)/1e4),_=r.getFullYear(),m=r.getMonth()+1,f=r.getDate();break;case"'":k("'")?w():b=!0;break;default:w()}if(l<i.length&&(o=i.substr(l),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===_?_=(new Date).getFullYear():100>_&&(_+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=_?0:-100)),v>-1)for(m=1,f=v;;){if(a=this._getDaysInMonth(_,m-1),a>=f)break;m++,f-=a}if(r=this._daylightSavingAdjust(new Date(_,m-1,f)),r.getFullYear()!==_||r.getMonth()+1!==m||r.getDate()!==f)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=s+1<t.length&&t.charAt(s+1)===e;return i&&s++,i},h=function(t,e,i){var s=""+e;if(l(t))for(;s.length<i;)s="0"+s;return s},u=function(t,e,i,s){return l(t)?s[e]:i[e]},c="",d=!1;if(e)for(s=0;s<t.length;s++)if(d)"'"!==t.charAt(s)||l("'")?c+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":c+=h("d",e.getDate(),2);break;case"D":c+=u("D",e.getDay(),n,a);break;case"o":c+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=h("m",e.getMonth()+1,2);break;case"M":c+=u("M",e.getMonth(),o,r);break;case"y":c+=l("y")?e.getFullYear():(e.getFullYear()%100<10?"0":"")+e.getFullYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":d=!0;break;default:c+=t.charAt(s)}return c},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=e+1<t.length&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;e<t.length;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),a=n,o=this._getFormatConfig(t);try{a=this.parseDate(i,s,o)||n}catch(r){s=e?"":s}t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),t.currentDay=s?a.getDate():0,t.currentMonth=s?a.getMonth():0,t.currentYear=s?a.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},a=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,h=l.exec(i);h;){switch(h[2]||"d"){case"d":case"D":r+=parseInt(h[1],10);break;case"w":case"W":r+=7*parseInt(h[1],10);break;case"m":case"M":o+=parseInt(h[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(h[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(a,o))}h=l.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"===o.toString()?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,a=t.selectedYear,o=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=o.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=o.getMonth(),t.drawYear=t.selectedYear=t.currentYear=o.getFullYear(),n===t.selectedMonth&&a===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,a,o,r,l,h,u,c,d,p,g,_,m,f,v,b,k,y,D,w,M,C,x,S,I,N,O,T,A,F,Y,E,L,P,j,W,K=new Date,H=this._daylightSavingAdjust(new Date(K.getFullYear(),K.getMonth(),K.getDate())),V=this._get(t,"isRTL"),R=this._get(t,"showButtonPanel"),U=this._get(t,"hideIfNoPrevNext"),z=this._get(t,"navigationAsDateFormat"),B=this._getNumberOfMonths(t),G=this._get(t,"showCurrentAtPos"),q=this._get(t,"stepMonths"),J=1!==B[0]||1!==B[1],X=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),$=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),Z=t.drawMonth-G,tt=t.drawYear;if(0>Z&&(Z+=12,tt--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-B[0]*B[1]+1,Q.getDate())),e=$&&$>e?$:e;this._daylightSavingAdjust(new Date(tt,Z,1))>e;)Z--,0>Z&&(Z=11,tt--);for(t.drawMonth=Z,t.drawYear=tt,i=this._get(t,"prevText"),i=z?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,Z-q,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,tt,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+i+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=z?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,Z+q,1)),this._getFormatConfig(t)):n,a=this._canAdjustMonth(t,1,tt,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+n+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+n+"</span></a>",o=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?X:H,o=z?this.formatDate(o,r,this._getFormatConfig(t)):o,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=R?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(V?l:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(V?"":l)+"</div>":"",u=parseInt(this._get(t,"firstDay"),10),u=isNaN(u)?0:u,c=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),g=this._get(t,"monthNames"),_=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),f=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),k="",D=0;D<B[0];D++){for(w="",this.maxRows=4,M=0;M<B[1];M++){if(C=this._daylightSavingAdjust(new Date(tt,Z,t.selectedDay)),x=" ui-corner-all",S="",J){if(S+="<div class='ui-datepicker-group",B[1]>1)switch(M){case 0:S+=" ui-datepicker-group-first",x=" ui-corner-"+(V?"right":"left");break;case B[1]-1:S+=" ui-datepicker-group-last",x=" ui-corner-"+(V?"left":"right");break;default:S+=" ui-datepicker-group-middle",x=""}S+="'>"}for(S+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+x+"'>"+(/all|left/.test(x)&&0===D?V?a:s:"")+(/all|right/.test(x)&&0===D?V?s:a:"")+this._generateMonthYearHeader(t,Z,tt,$,Q,D>0||M>0,g,_)+"</div><table class='ui-datepicker-calendar'><thead><tr>",I=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",y=0;7>y;y++)N=(y+u)%7,I+="<th scope='col'"+((y+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[N]+"'>"+p[N]+"</span></th>";for(S+=I+"</tr></thead><tbody>",O=this._getDaysInMonth(tt,Z),tt===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,O)),T=(this._getFirstDayOfMonth(tt,Z)-u+7)%7,A=Math.ceil((T+O)/7),F=J&&this.maxRows>A?this.maxRows:A,this.maxRows=F,Y=this._daylightSavingAdjust(new Date(tt,Z,1-T)),E=0;F>E;E++){for(S+="<tr>",L=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(Y)+"</td>":"",y=0;7>y;y++)P=m?m.apply(t.input?t.input[0]:null,[Y]):[!0,""],j=Y.getMonth()!==Z,W=j&&!v||!P[0]||$&&$>Y||Q&&Y>Q,L+="<td class='"+((y+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(Y.getTime()===C.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===Y.getTime()&&b.getTime()===C.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!f?"":" "+P[1]+(Y.getTime()===X.getTime()?" "+this._currentClass:"")+(Y.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(j&&!f||!P[2]?"":" title='"+P[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+Y.getMonth()+"' data-year='"+Y.getFullYear()+"'")+">"+(j&&!f?"&#xa0;":W?"<span class='ui-state-default'>"+Y.getDate()+"</span>":"<a class='ui-state-default"+(Y.getTime()===H.getTime()?" ui-state-highlight":"")+(Y.getTime()===X.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+Y.getDate()+"</a>")+"</td>",Y.setDate(Y.getDate()+1),Y=this._daylightSavingAdjust(Y);S+=L+"</tr>"}Z++,Z>11&&(Z=0,tt++),S+="</tbody></table>"+(J?"</div>"+(B[0]>0&&M===B[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),w+=S}k+=w}return k+=h,t._keyEvent=!1,k},_generateMonthYearHeader:function(t,e,i,s,n,a,o,r){var l,h,u,c,d,p,g,_,m=this._get(t,"changeMonth"),f=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",k="";if(a||!m)k+="<span class='ui-datepicker-month'>"+o[e]+"</span>";else{for(l=s&&s.getFullYear()===i,h=n&&n.getFullYear()===i,k+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=s.getMonth())&&(!h||u<=n.getMonth())&&(k+="<option value='"+u+"'"+(u===e?" selected='selected'":"")+">"+r[u]+"</option>");k+="</select>"}if(v||(b+=k+(!a&&m&&f?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",a||!f)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},g=p(c[0]),_=Math.max(g,p(c[1]||"")),g=s?Math.max(g,s.getFullYear()):g,_=n?Math.min(_,n.getFullYear()):_,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";_>=g;g++)t.yearshtml+="<option value='"+g+"'"+(g===i?" selected='selected'":"")+">"+g+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!a&&m&&f?"":"&#xa0;")+k),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),a=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),o=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,a)));t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),a=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(t,a)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),o=null,r=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!a||e.getTime()<=a.getTime())&&(!o||e.getFullYear()>=o)&&(!r||e.getFullYear()<=r)},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new i,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.0-rc.2";var u=(t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),!1);t(document).on("mouseup",function(){u=!1});t.widget("ui.mouse",{version:"1.12.0-rc.2",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!u){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),u=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,u=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.widget("ui.slider",t.ui.mouse,{version:"1.12.0-rc.2",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),a="<span tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)o.push(a);this.handles=n.add(t(o.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),
this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,a,o,r,l,h,u=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-u.values(e));(n>i||n===i&&(e===u._lastChangedValue||u.values(e)===c.min))&&(n=i,a=t(this),o=e)}),r=this._start(e,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,this._addClass(a,null,"ui-state-active"),a.trigger("focus"),l=a.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,a=this.value(),o=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),a=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),o[e]=i),i!==a&&(s=this._trigger("slide",t,this._uiHash(e,i,o)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var s,n,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],a=0;a<s.length;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;s<i.length;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=t.toString(),i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,a,o=this.options.range,r=this.options,l=this,h=this._animateOff?!1:r.animate,u={};this._hasMultipleValues()?this.handles.each(function(s){i=(l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())*100,u["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](u,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?(s-n)/(a-n)*100:0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:100-i+"%"},r.animate),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,a,o=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,o),i===!1))return}switch(a=this.options.step,s=n=this._hasMultipleValues()?this.values(o):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(e,o,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e};t.widget("ui.spinner",{version:"1.12.0-rc.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=t.toString(),i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&t<s.min?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,void this.element.val(this._format(i))):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),void this._super(t,e))},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:o(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:o(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:o(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:o(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:o(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void o(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}});t.ui.spinner});
location.host.indexOf("test.somethingyoulove.com")<0&&document.write('<script src="http://'+(location.host||"localhost").split(":")[0]+':35729/livereload.js?snipver=1"></script>');
var markerHandler=function(){return{Init:function(n){}}}();
var multiselect=function(){function e(e,t){var i="Showing "+e.selected.length+" carriers";e.items.length==e.selected.length?i="Showing all carriers":1==e.selected.length&&(i="Showing 1 carrier"),$(e).find(".multiselect-field").html(i)}function t(e){for(i=0;i<e.selected.length;i++)$(".multiselect-list li:nth-child("+(parseInt(e.selected[i])+1)+") input[type=checkbox]").prop("checked",!0)}function n(e){var t=[];$(e).find("input[type=checkbox]").each(function(){$(this).prop("checked")&&t.push($(this).parent().index())}),e.selected=t,console.log("currently checked",e.selected)}function c(t){$(t.items).find("input[type=checkbox]").bind("change",function(){n(t),e(t)}),$(t).find(".multiselect-field").bind("click",function(){$(this).parent().toggleClass("open")})}return{Init:function(){$(".multiselect").each(function(){this.selected=$(this).data("initially-selected").split(","),this.items=$(this).find(".multiselect-list li"),e(this),t(this),c(this)})}}}();multiselect.Init();
function people(n){$(".popover.people").toggleClass("show"),$(n).hasClass("btn")&&(1==$("#spinner").val()?$(".btn.people p").html($("#spinner").val()+" person"):$(".btn.people p").html($("#spinner").val()+" persons"))}$(function(){$("#spinner").spinner({min:1,max:9}),$("#spinner2").spinner({min:0,max:9,val:0}),$("#spinnerCard").spinner({min:0,max:numberTraveller}),$(".ui-spinner-button").click(function(){$(this).siblings("input").change()}),$("#spinner").bind("change",function(){var n=$(this).val();$("#spinner2").spinner("option","max",n),$("#spinner2").val()>n&&$("#spinner2").val(n)}),$(".people").on("click",".ui-spinner-button",function(n){n.preventDefault(),numberTraveller=$(this).parent().find("input").val(),1==numberTraveller?($(".cards .travellers").html("For 1 traveller"),$(".ticket_finder header .initial .summary").html("Return trip, 1 traveller")):($(".cards .travellers").html("For "+numberTraveller+" travellers"),$(".ticket_finder header .initial .summary").html("Return trip, "+numberTraveller+" travellers")),1==$("#spinner").val()?$(".btn.peopleButton p").html($("#spinner").val()+" person"):$(".btn.peopleButton p").html($("#spinner").val()+" persons");var e=parseInt($(this).parent().find("input").spinner("option","min")),r=parseInt($(this).parent().find("input").spinner("option","max"));return numberTraveller<e+1?$(this).parent().find(".ui-spinner-down").css("opacity","0.4"):numberTraveller>=r?$(this).parent().find(".ui-spinner-up").css("opacity","0.4"):$(this).parent().find(".ui-spinner-down, .ui-spinner-up").css("opacity","1"),!1})});
var searchHandler=function(){function t(t){var n=$(t.target).val();(t.target.searchValue!=n||13==t.keyCode)&&("undefined"!=typeof t.altKey&&$(".tabNav.locations .nav li:contains(Network)").trigger("click"),$(".results.network").html(" "),busStops([{city:{likenocase:n}},{country:{likenocase:n}}]).order("country,city").each(function(t){var n=document.createElement("li");n.innerHTML="<p>"+t.city+"</p>",$(".results.network").append(n),$(n).unbind("click"),$(n).bind("click",e)}),1==$(t.target).attr("tabindex")&&(r.start.name=void 0,enableAllDestinations()),t.target.searchValue=n,13==t.keyCode&&($(".results.network li:containsNC("+n+")").trigger("click"),1==$(t.target).attr("tabindex")&&setTimeout(function(){$(t.target).removeClass("active"),$(".journey input[tabindex=2]").focus().addClass("active")},700)))}function e(t){var e=parentWithTagName(t.target,"li"),n=$(e).find("p").html(),a=$('.cityLabel h3:contains("'+n+'")').parent().parent();if(1==$(i).attr("tabindex"))r.start.name=n,"undefined"!=typeof a[0]&&(r.start.position.lat=a[0].marker.position.lat(),r.start.position.lng=a[0].marker.position.lng(),r.start.marker=a[0].marker,$(".ticket_details .from").html(r.start.name));else{if(n==r.start.name)return r.end.name="",!1;r.end.name=n,"undefined"!=typeof a[0]&&(r.end.position.lat=a[0].marker.position.lat(),r.end.position.lng=a[0].marker.position.lng(),r.end.marker=a[0].marker,$(".ticket_details .to").html(r.end.name))}"undefined"==typeof a[0]?updateMarkers():google.maps.event.trigger(a[0].marker,"click"),$(".journey").removeClass("expanded")}function n(t){$(i).removeClass("active"),i=t.target,$(i).addClass("active"),$(".journey").addClass("expanded"),"undefined"!=typeof i.activeTab?$(".journey .locations ul.nav").find("li:nth-child("+(i.activeTab+1)+")").trigger("click"):1==$(i).attr("tabindex")?$(".journey .locations ul.nav").find("li:nth-child(1)").trigger("click"):$(".journey .locations ul.nav").find("li:nth-child(2)").trigger("click")}function a(){"undefined"!=typeof r.start.name&&"undefined"!=typeof r.end.name?$(".journey").hasClass("submittable")&&r.start.name==o.start.name&&r.end.name==o.end.name||(console.log("submittable",$(".journey")),$(".journey").addClass("submittable"),setTimeout(repositionMapToJourney,100)):(console.log("not submittable"),$(".journey").removeClass("submittable")),o=jQuery.extend(!0,{},r),"undefined"!=typeof r.start.name&&disableUnavailableDestinations(r)}var i,r={start:{position:{}},end:{position:{}}},o=jQuery.extend(!0,{},r);return{activateSearch:function(e){$(e).focus();var n={target:e};t(n)},setElementFocus:function(t){i=t[0],$(".journey input[type=search]").removeClass("active"),t.addClass("active")},setupStations:function(){busStops().order("country,city").each(function(t){var e=document.createElement("li");e.innerHTML=t.city,$(".results.network").append(e)})},Init:function(){$(".journey input[type=search]").each(function(){$(this).hasClass("active")&&(i=this),$(this).bind("keyup",t),$(this).bind("focus",n)}),$(".options .results li").unbind("click").bind("click",e)},getJourney:function(){return{begin:r.start.name,end:r.end.name}},getJourneyInformation:function(){return r},fillInCity:function(t){(2!=i.getAttribute("tabindex")||t.title!=r.start.name)&&("undefined"!=typeof i.marker&&("A"==i.marker.type?targetIcon=imageCityBig:targetIcon=imageCitySmall,i.marker.setIcon(targetIcon),i.marker.labelElm.removeClass("selected")),i.marker=t,$(i).val(t.title),t.setIcon(imageCitySelected),t.labelElm.addClass("selected"),1==i.getAttribute("tabindex")?(r.start.name=t.title,$(i).removeClass("active"),i=$(".journey input[tabindex=2]")[0],$(i).addClass("active"),r.start.name=t.title,r.start.position.lat=t.position.lat(),r.start.position.lng=t.position.lng(),r.start.marker=t,$(".ticket_details .from").html(r.start.name)):(stationEnd=t.title,r.end.name=t.title,r.end.position.lat=t.position.lat(),r.end.position.lng=t.position.lng(),r.end.marker=t,$(".ticket_details .to").html(r.end.name)),a())}}}();searchHandler.Init();
var tabNav=function(){function i(){n.find("li").bind("click",function(i){$(".journey input.active")[0].activeTab=$(this).index(),n.find("li").removeClass("active"),$(this).addClass("active"),t.find("ul").removeClass("active"),t.find("ul:nth-child("+($(this).index()+1)+")").addClass("active"),setTimeout(function(i){i.scrollTop(0)},300,t)})}var n,t;return{Init:function(a){n=$(a).find(".nav"),t=$(a).find(".options"),n.find("li:first-child").addClass("active"),t.find("ul:first-child").addClass("active"),i()}}}();$(".tabNav").each(function(){tabNav.Init(this)});
var ticketDetails=function(){function t(t){console.log("back request from",t.target),$(t.target).hasClass("from")?$(".journey input[tabindex=1]").trigger("focus"):$(".journey input[tabindex=2]").trigger("focus"),tripLockedIn=!1,document.location.hash="#",updateMarkers(),$(".journey .locations li:contains(Recent)").trigger("click")}return{Init:function(){$(".ticket_details").find(".to, .from").bind("click",t)}}}();$(function(){ticketDetails.Init()});
function loadOutFile(){console.log("loading out file"),$(".popover.time").removeClass("filtered"),$("#slider-range").slider("values",0,0),$(".range input#start").val("00:00"),$("#slider-range").slider("values",1,24),$(".range input#end").val("24:00"),$("#departure2").prop("checked",!0),$(".popover.filters .overscroll").scrollTop(0);$.getJSON("feeds/"+outFile,{format:"json"},function(e){departure_data=e,globalJSON=e,dataHandler(e,{direction:trainDirection},"time")}).done(function(){}).fail(function(e){console.log("error",e)})}function loadReturnFile(){$(".popover.time").removeClass("filtered"),$("#slider-range").slider("values",0,0),$(".range input#start").val("00:00"),$("#slider-range").slider("values",1,24),$(".range input#end").val("24:00"),$("#departure2").prop("checked",!0),$(".popover.filters .overscroll").scrollTop(0);$.getJSON("feeds/"+returnFile,{format:"json"},function(e){departure_data=e,globalJSON=e,dataHandler(e,{direction:trainDirection},"time")}).done(function(){}).fail(function(e){console.log("error",e)})}function applyFilters(){$(".popover.time").removeClass("filtered"),$("#slider-range").slider("values",0,0),$(".range input#start").val("00:00"),$("#slider-range").slider("values",1,24),$(".range input#end").val("24:00"),$("#departure2").prop("checked",!0),$(".popover.filters .overscroll").scrollTop(0),$(".popover.time").hasClass("return")?targetFile=returnFile:targetFile=outFile,console.log($("#cost2").prop("checked"),$("#duration2").prop("checked")),orderby="time",$("#cost2").prop("checked")?orderby="price":$("#duration2").prop("checked")&&(orderby="duration");$.getJSON("feeds/"+targetFile,{format:"json"},function(e){departure_data=e,globalJSON=e;parseInt($(".range input#start").val().replace(":","")),parseInt($(".range input#end").val().replace(":"),"");dataHandler(e,!1,orderby,!1),console.log(orderby)}).done(function(){}).fail(function(e){console.log("error",e)})}function doFilter(){$(".popover.time").hasClass("return")?targetFile=returnFile:targetFile=outFile,console.log($("#cost2").prop("checked"),$("#duration2").prop("checked")),orderby="time",$("#cost2").prop("checked")?orderby="price":$("#duration2").prop("checked")&&(orderby="duration");$.getJSON("feeds/"+targetFile,{format:"json"},function(e){departure_data=e,globalJSON=e;var r=parseFloat($(".range input#start").val().replace(":","")),t=parseFloat($(".range input#end").val().replace(":",""));console.log("filtering time:",r,t),dataHandler(e,!1,orderby,!1),console.log(orderby)}).done(function(){}).fail(function(e){console.log("error",e)})}function quickFilter(){$(".popover.time").hasClass("return")?targetFile=returnFile:targetFile=outFile;var e="time";$("#cost2").prop("checked")?e="price":$("#duration2").prop("checked")&&(e="duration");$.getJSON("feeds/"+targetFile,{format:"json"},function(r){departure_data=r,globalJSON=r;parseInt($(".range input#start").val().replace(":","")),parseInt($(".range input#end").val().replace(":",""));count=dataHandler(r,!1,e,!0),$(".popover.filters button").html("See "+count+" results")}).done(function(){}).fail(function(e){console.log("error",e)})}function dataHandler(e,r,t,n){if("undefined"==typeof e&&(e=globalJSON,"undefined"==typeof e))return!1;var l=TAFFY(e);if($(".toggle.direct .right").hasClass("current"))var o={leg_count:1};else var o={leg_count:{gte:1}};var s=parseInt($(".range input#start").val().replace(":","")),c=parseInt($(".range input#end").val().replace(":",""));if(n){var d=TAFFY(e),u=d({time:{gte:s}},{time:{lt:c}},o).count();return console.log(d({time:{gte:s}},{time:{lt:c}},o)),u}$(".filter_drawer button").html("See "+l().count()+" results");var p=l().order("price").first();document.querySelector(".time .cards ul").innerHTML="";var g=0;l({time:{gte:s}},{time:{lt:c}},o).order(t).each(function(e){var r=pad(e.time,4),t=now.getMonth()+"/"+now.getDate()+"/"+now.getFullYear()+" "+r.substring(0,2)+":"+r.substring(2,4)+":00";t=new Date(t);var n=t,l=new Date(n.getTime()+6e4*e.duration),o=document.createElement("li");o.journeyData=e,o.addEventListener("click",cardClickHandler);var s=e.price;if(basePrice=s,g>7)var c="";else var c="goes";e.price==p.price?o.className="cheapest "+c:o.className="regular "+c;var d;d=1!=e.leg.length?2==e.leg.length?"1 transfer":e.leg.length-1+" transfers":"Direct";var u={};u.hours=Math.floor(e.duration/60),u.minutes=e.duration-60*u.hours;var v=pad(n.getHours(),2)+":"+pad(n.getMinutes(),2),f=pad(l.getHours(),2)+":"+pad(l.getMinutes(),2);depTimeAMPM=formatAMPM(n),arrTimeAMPM=formatAMPM(l),e.seats_left<9?carrierInfo='<div class="hero"><p>Megabus<br/><span>Only '+e.seats_left+" seats left</span></p></div>":carrierInfo='<div class="hero"><p>Megabus</p></div>';var m="<ul>";for(i=0;i<e.leg.length;i++)for(a=0;a<e.leg[i].stop.length-1;a++){var $="stop";0==a&&($="stop newleg"),m+='<li class="'+$+'" title="'+e.leg[i].stop[a].city+'"></li>'}m+='<li class="stop" title="'+e.arrival_city+'"></li></ul>',ticketHTML='<div class="container"><header class="deptime" data-departure="'+v+'" data-arrival="'+f+'" data-duration="'+e.duration+'">\n                           <div class="left"><p>'+depTimeAMPM+' <img src="img/arrowright.svg"> '+arrTimeAMPM+'</p>\n                            <span class="duration">'+u.hours+"h "+u.minutes+"m, "+d+"</span></div>\n                            "+carrierInfo+'\n                            <div class="right"><div class="price" data-price="'+s+'">'+currency+s+'</div>\n                            <div class="travellers">For '+numberTraveller+" traveller(s)</div></div>\n                        </header>",ticketHTML+='<div class="timetable">\n                            <div class="description">\n                                <div class="departure">'+depTimeAMPM+'\n                                    <br/><span class="stationlink">'+e.departure_city+", "+e.departure_station+'</span></div>\n                                <div class="change">'+d+'</div>\n                                <div class="destination">'+arrTimeAMPM+'\n                                    <br/><span class="stationlink">'+e.arrival_city+", "+e.arrival_station+'</span></div>\n                            </div>\n                            <div class="route">\n                            	'+m+'\n                            </div>\n                        </div>\n                         <footer>\n                         	<div class="full_route">\n                         		<a href="#" onclick="openItineraryDrawer(this);return false;">View full route</a>\n                         	</div>\n                            <div class="facilities">\n                            	On-board services:\n                            	<ul>\n                            		<li><img src="img/facilities_wifi.svg?1"></li>\n                            		<li><img src="img/facilities_assisted.svg?1"></li>\n                            		<li><img src="img/facilities_power.svg?1"></li>\n                            		<li><img src="img/facilities_bicycle.svg?1"></li>\n                            		<li><img src="img/facilities_drink.svg?1"></li>\n                                </ul>\n                            </div>\n                        	<div class="cta">\n                        		<button type="button" class="small" onclick="selectTicket(this)">Select ticket</button>\n                        	</div>\n                        </footer>',o.innerHTML=ticketHTML,document.querySelector(".time .cards ul").appendChild(o),g++}),"undefined"!=typeof endObj&&scrollEndHandler(endObj),$(".filter_drawer button").html("See "+g+" results"),$(".ticket_finder").hasClass("show")&&setTimeout(time,200)}function formatMinutes(e){var r=Math.floor(e/60),t=e-60*r;return r+"h "+t+"m"}function clone(e){if(null==e||"object"!=typeof e)return e;var r=e.constructor();for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function formatPrice(e){var r;return r=0>e?"- "+currency+Math.abs(e).toFixed(2):"+ "+currency+e.toFixed(2)}function updatePriceList(){$("."+trainDirection+" ul.travel_list li").each(function(e,r){$(".price",$(r)).html(formatPrice(calculatePriceDifference(r.journeyData)))})}var trainDirection="",globalJSON,currency="$",outFile="newyork-washington.json",returnFile="washington-newyork.json",travellers=1;$(function(){loadOutFile()});
function pad(e,t,n){return n=n||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(n)+e}function addDays(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n}function transformMatrixToArray(e){var t=e.replace("matrix(","").replace(")","").split(",");return t}function hasParentWithClass(e,t){return"BODY"==e.tagName?!1:$(e).hasClass(t)?!0:hasParentWithClass(e.parentNode,t)}function parentWithTagName(e,t){if("BODY"==e.tagName)return!1;var n=e.tagName;return n.toLowerCase()==t.toLowerCase()?e:parentWithTagName(e.parentNode,t)}function formatMinutes(e){var t=Math.floor(e/60),n=e-60*t;return t+"h "+n+"m"}function formatPrice(e){var t;return t=0>e?"- Â£"+Math.abs(e).toFixed(2):"+ Â£"+e.toFixed(2)}function clearAllIntervals(){"undefined"==typeof clearAllIntervals.last&&(clearAllIntervals.last=setTimeout("||void",0));for(var e=setInterval("||void",0),t=clearAllIntervals.last;e>=t;t++)clearInterval(t);clearAllIntervals.last=t}function generateRandomNumb(e,t){return Math.floor(Math.random()*(t-e)+e)}function addCSSRule(e){-1==$.inArray(e,dynamicCSSRules)&&($("head").append("<style>"+e+"</style>"),dynamicCSSRules.push(e))}function addCSSRule(e){-1==$.inArray(e,dynamicCSSRules)&&($("head").append("<style>"+e+"</style>"),dynamicCSSRules.push(e))}function isElementInViewport(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function formatAMPM(e,t){var n=e.getHours(),a=e.getMinutes(),r=n>=12?"PM":"AM";n%=12,n=n?n:12,n=10>n?"0"+n:n,a=10>a?"0"+a:a;var l=n+":"+a+' <span class="ampm">'+r+"</span>";return l}clearAllIntervals(),$(".toggle .element").on("click",function(){$(this).parent().find(".element").removeClass("current"),$(this).addClass("current"),$(this).is(".right")?($("#jrange").addClass("double"),$("#calendar").addClass("double").removeClass("single")):($("#jrange").removeClass("double"),$("#calendar").addClass("single").removeClass("double"))}),$.extend($.expr[":"],{containsNC:function(e,t,n,a){return(e.textContent||e.innerText||"").toLowerCase().indexOf((n[3]||"").toLowerCase())>=0}});
//# sourceMappingURL=site.js.map
