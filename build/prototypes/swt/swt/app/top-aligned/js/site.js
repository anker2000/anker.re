(window._gsQueue||(window._gsQueue=[])).push(function(){_gsDefine("plugins.ScrollToPlugin",["plugins.TweenPlugin"],function(t){var o=function(o,s){t.call(this,"scrollTo"),this._overwriteProps.pop()},s=o.prototype=new t("scrollTo"),e=function(){return null!=window.pageXOffset?window.pageXOffset:null!=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},i=function(){return null!=window.pageYOffset?window.pageYOffset:null!=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},l=t.prototype.setRatio;return s.constructor=o,o.API=2,s._onInitTween=function(t,o,s){return this._wdw=t==window,this._target=t,"object"!=typeof o&&(o={y:Number(o)}),this.x=this._wdw?e():t.scrollLeft,this.y=this._wdw?i():t.scrollTop,null!=o.x?this._addTween(this,"x",this.x,o.x,"scrollTo_x",!0):this.skipX=!0,null!=o.y?this._addTween(this,"y",this.y,o.y,"scrollTo_y",!0):this.skipY=!0,!0},s._kill=function(o){return o.scrollTo_x&&(this.skipX=!0),o.scrollTo_x&&(this.skipY=!0),t.prototype._kill.call(this,o)},s.setRatio=function(t){l.call(this,t),this._wdw?window.scrollTo(this.skipX?e():this.x,this.skipY?i():this.y):(this.skipY||(this._target.scrollTop=this.y),this.skipX||(this._target.scrollLeft=this.x))},t.activate([o]),o},!0)}),window._gsDefine&&_gsQueue.pop()();
function enterLocating(){document.location.hash="locating",$("body").addClass("locate"),$(".route_vertical button").css("opacity",1),$(".route_vertical").addClass("active"),stepAnimate(".locating"),$(".back_nav").removeClass("inactive"),$(".route_vertical button.next").bind("click",function(){$(".route_container").removeClass("on"),setTimeout(function(){document.location.href="scanner.php"},300)}),$(".search_station .back_nav").bind("click",function(){clearTimeout(footerTimeout),$(".route_vertical").removeClass("active"),$("body").removeClass("locate"),$("footer").removeClass("active"),$(this).addClass("inactive"),$(".route_vertical *").removeClass("on blink"),$(window).unbind("hashchange"),openDestinationScreen(),$(window).bind("hashchange",hashChangeHandler)}),setTimeout(function(){$(".route_container").addClass("on")},300),setTimeout(function(){$(".route_vertical .first-line").addClass("on"),$(".route_vertical .blue-circle").filter(":first").addClass("on"),$(".route_vertical .first_station").addClass("on")},700),setTimeout(function(){$(".route_vertical .second-line").addClass("on"),$(".route_vertical .change-stop").addClass("on"),$(".route_vertical .change_station").addClass("on")},1500),setTimeout(function(){$(".route_vertical .blue-circle").filter(":last").addClass("on"),$(".route_vertical .last_station").addClass("on"),$(".route_vertical .last_station small").addClass("blink")},2200),setTimeout(function(){$(".route_vertical .third-line").addClass("on")},2400),setTimeout(function(){$(".route_vertical .fourth-line").addClass("on")},3e3),setTimeout(function(){$("p strong").html("2hr 02min")},3500),footerTimeout=setTimeout(function(){$("footer").addClass("active")},4500)}function locatingToScanner(){$(".route_vertical").removeClass("active"),setTimeout(function(){document.location.href="scanner.php"},300)}function openDestinationScreen(){document.location.hash="",setTimeout(function(){$("section.helper").removeClass("inactive")},300),setTimeout(function(){},600),$("footer").removeClass("active")}function closeDestinationScreen(){setTimeout(function(){$("section.helper").addClass("inactive")},300),setTimeout(function(){},600)}function closeHomeScreen(){$("body.home .top").css("transition-duration","0.4s").css("transition-timing-function","cubic-bezier(.73,0,1,.46)").css("transform","translateY(-500px)").css("opacity",0),$("body.home .bottom").css("transition-duration","0.4s").css("transition-timing-function","cubic-bezier(.73,0,1,.46)").css("transform","translateY(500px)").css("opacity",0)}function enterHomeScreen(e){console.log("enter home"),lastActiveScreen="home",$("body.home .opacityZero").each(function(e,t){$(t).css("opacity",1)}),"undefined"==typeof e&&(e=1200),setTimeout(function(){first&&(clock_slider.Init($(".clock_slider").eq(0),0),first=!1)},e)}function enterJourneyScreen(){$("body").addClass("journeyview").removeClass("closejourney"),$(".back_nav").addClass("inactive"),$(".journey .opacityZero:not(.changes)").each(function(e,t){setTimeout(function(e){$(e).animate({opacity:1},300)},270*e+500,t)}),$(".journey").addClass("active"),$(".journey").scrollTop(($(".journey")[0].scrollHeight-$(window).height())/2),$(".journey ul li:nth-child(4)").addClass("travel"),$(".journey ul .current_status").addClass("travel")}function closeWhatEver(){document.location.href="scanner.php"}function closeJourneyScreen(){$(".travel").removeClass("travel"),$(".journey").removeClass("active"),$("body").addClass("journeyview closejourney")}function stepAnimate(e){$(".opacityZero",$(e)).each(function(e,t){setTimeout(function(e){$(e).css("opacity",1)},100*e,t)})}function stepAnimateFast(e){$(".opacityZero",$(e)).each(function(e,t){setTimeout(function(e){$(e).css("opacity",1)},170*e,t)})}function enterPlanning(){lastActiveScreen="planning",$(".planning.screen").css("opacity",0),$(".planning.screen").css("display","block"),$(".screen.planning").animate({opacity:1},300),stepAnimate(".planning.screen")}function enterSchedule(){setTimeout(schedule.sizeUp,1e3),$(".screen.planning").animate({opacity:0},300),setTimeout(function(){$(".screen.schedule .faded").removeClass("faded"),$(".screen.planning").css("display","none"),$(".screen.schedule").css("display","block").animate({opacity:1},300).addClass("active"),$(".screen.schedule .schedule_container").removeClass("step1 step2 step3 step4 step5"),$(".screen.schedule .schedule_container").addClass("step1")},300)}function closeSchedule(){$(".screen.schedule").animate({opacity:0},300),setTimeout(function(){$(".screen.schedule .schedule_container").removeClass("step1 step2 step3 step4"),$(".screen.schedule").css("display","none")},300)}function initiateScreen(){first&&(clock_slider.Init($(".clock_slider").eq(0),0),first=!1)}var lastActiveScreen="home";$(function(){function e(){$(".home .info").each(function(){var e=$(this);$("span",e).length>1&&($("span:first-child",e).css("transition-duration","0.5s").css("transform","translateY(-42px)"),$("span:last-child",e).css("transition-duration","0.5s").css("transform","translateY(-42px)"),setTimeout(function(){$("span:last-child",e).prependTo(e),$("span:first-child",e).css("transition-duration","0s").css("transform","translateY(0px)"),$("span:last-child",e).css("transition-duration","0s").css("transform","translateY(0px)")},500))}),setTimeout(e,7e3)}$(".react").bind("touchstart touchend",function(e){$(this).toggleClass("touch")}),$("body").hasClass("search_station")&&"#locating"==document.location.hash&&($("div.search_station").css("display","none").addClass("inactive"),$("section.helper").css("display","none"),setTimeout(function(){$("div.search_station").removeAttr("style"),$("section.helper").removeAttr("style")},750),enterLocating()),$(".controls").css("opacity",1),stepAnimate("body"),$("body.home div.changes").bind("click",function(){closeHomeScreen(),enterJourneyScreen(),$(".burger").addClass("close-button")}),$(".home.screen .get_tickets button").bind("click",function(){closeHomeScreen(),setTimeout(function(){enterPlanning()},1200)}),setTimeout(e,7e3)});var footerTimeout;first=!0,$(function(){$("body.home").each(initiateScreen)});
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t,e){function a(){return new Date(Date.UTC.apply(Date,arguments))}function i(){var t=new Date;return a(t.getFullYear(),t.getMonth(),t.getDate())}function s(t,e){return t.getUTCFullYear()===e.getUTCFullYear()&&t.getUTCMonth()===e.getUTCMonth()&&t.getUTCDate()===e.getUTCDate()}function n(t){return function(){return this[t].apply(this,arguments)}}function o(t){return t&&!isNaN(t.getTime())}function r(e,a){function i(t,e){return e.toLowerCase()}var s,n=t(e).data(),o={},r=new RegExp("^"+a.toLowerCase()+"([A-Z])");a=new RegExp("^"+a.toLowerCase());for(var h in n)a.test(h)&&(s=h.replace(r,i),o[s]=n[h]);return o}function h(e){var a={};if(D[e]||(e=e.split("-")[0],D[e])){var i=D[e];return t.each(g,function(t,e){e in i&&(a[e]=i[e])}),a}}var l=function(){var e={get:function(t){return this.slice(t)[0]},contains:function(t){for(var e=t&&t.valueOf(),a=0,i=this.length;i>a;a++)if(this[a].valueOf()===e)return a;return-1},remove:function(t){this.splice(t,1)},replace:function(e){e&&(t.isArray(e)||(e=[e]),this.clear(),this.push.apply(this,e))},clear:function(){this.length=0},copy:function(){var t=new l;return t.replace(this),t}};return function(){var a=[];return a.push.apply(a,arguments),t.extend(a,e),a}}(),d=function(e,a){this._process_options(a),this.dates=new l,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=t(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.hasClass("date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=t(m.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot .today, tfoot .clear").attr("colspan",function(t,e){return parseInt(e)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.setDaysOfWeekHighlighted(this.o.daysOfWeekHighlighted),this.setDatesDisabled(this.o.datesDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};d.prototype={constructor:d,_process_options:function(s){this._o=t.extend({},this._o,s);var n=this.o=t.extend({},this._o),o=n.language;switch(D[o]||(o=o.split("-")[0],D[o]||(o=f.language)),n.language=o,n.startView){case 2:case"decade":n.startView=2;break;case 1:case"year":n.startView=1;break;default:n.startView=0}switch(n.minViewMode){case 1:case"months":n.minViewMode=1;break;case 2:case"years":n.minViewMode=2;break;default:n.minViewMode=0}switch(n.maxViewMode){case 0:case"days":n.maxViewMode=0;break;case 1:case"months":n.maxViewMode=1;break;default:n.maxViewMode=2}n.startView=Math.min(n.startView,n.maxViewMode),n.startView=Math.max(n.startView,n.minViewMode),n.multidate!==!0&&(n.multidate=Number(n.multidate)||!1,n.multidate!==!1&&(n.multidate=Math.max(0,n.multidate))),n.multidateSeparator=String(n.multidateSeparator),n.weekStart%=7,n.weekEnd=(n.weekStart+6)%7;var r=m.parseFormat(n.format);if(n.startDate!==-(1/0)&&(n.startDate=n.startDate?n.startDate instanceof Date?this._local_to_utc(this._zero_time(n.startDate)):m.parseDate(n.startDate,r,n.language):-(1/0)),n.endDate!==1/0&&(n.endDate=n.endDate?n.endDate instanceof Date?this._local_to_utc(this._zero_time(n.endDate)):m.parseDate(n.endDate,r,n.language):1/0),n.daysOfWeekDisabled=n.daysOfWeekDisabled||[],t.isArray(n.daysOfWeekDisabled)||(n.daysOfWeekDisabled=n.daysOfWeekDisabled.split(/[,\s]*/)),n.daysOfWeekDisabled=t.map(n.daysOfWeekDisabled,function(t){return parseInt(t,10)}),n.daysOfWeekHighlighted=n.daysOfWeekHighlighted||[],t.isArray(n.daysOfWeekHighlighted)||(n.daysOfWeekHighlighted=n.daysOfWeekHighlighted.split(/[,\s]*/)),n.daysOfWeekHighlighted=t.map(n.daysOfWeekHighlighted,function(t){return parseInt(t,10)}),n.datesDisabled=n.datesDisabled||[],!t.isArray(n.datesDisabled)){var h=[];h.push(m.parseDate(n.datesDisabled,r,n.language)),n.datesDisabled=h}n.datesDisabled=t.map(n.datesDisabled,function(t){return m.parseDate(t,r,n.language)});var l=String(n.orientation).toLowerCase().split(/\s+/g),d=n.orientation.toLowerCase();if(l=t.grep(l,function(t){return/^auto|left|right|top|bottom$/.test(t)}),n.orientation={x:"auto",y:"auto"},d&&"auto"!==d)if(1===l.length)switch(l[0]){case"top":case"bottom":n.orientation.y=l[0];break;case"left":case"right":n.orientation.x=l[0]}else d=t.grep(l,function(t){return/^left|right$/.test(t)}),n.orientation.x=d[0]||"auto",d=t.grep(l,function(t){return/^top|bottom$/.test(t)}),n.orientation.y=d[0]||"auto";else;if(n.defaultViewDate){var c=n.defaultViewDate.year||(new Date).getFullYear(),u=n.defaultViewDate.month||0,p=n.defaultViewDate.day||1;n.defaultViewDate=a(c,u,p)}else n.defaultViewDate=i();n.showOnFocus=n.showOnFocus!==e?n.showOnFocus:!0,n.zIndexOffset=n.zIndexOffset!==e?n.zIndexOffset:10},_events:[],_secondaryEvents:[],_applyEvents:function(t){for(var a,i,s,n=0;n<t.length;n++)a=t[n][0],2===t[n].length?(i=e,s=t[n][1]):3===t[n].length&&(i=t[n][1],s=t[n][2]),a.on(s,i)},_unapplyEvents:function(t){for(var a,i,s,n=0;n<t.length;n++)a=t[n][0],2===t[n].length?(s=e,i=t[n][1]):3===t[n].length&&(s=t[n][1],i=t[n][2]),a.off(i,s)},_buildEvents:function(){var e={keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this),paste:t.proxy(this.paste,this)};this.o.showOnFocus===!0&&(e.focus=t.proxy(this.show,this)),this.isInput?this._events=[[this.element,e]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),e],[this.component,{click:t.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:t.proxy(function(t){this._focused_from=t.target},this)}],[this.element,{blur:t.proxy(function(t){this._focused_from=t.target},this)}]),this.o.immediateUpdates&&this._events.push([this.element,{"changeYear changeMonth":t.proxy(function(t){this.update(t.date)},this)}]),this._secondaryEvents=[[this.picker,{click:t.proxy(this.click,this)}],[t(window),{resize:t.proxy(this.place,this)}],[t(document),{mousedown:t.proxy(function(t){this.element.is(t.target)||this.element.find(t.target).length||this.picker.is(t.target)||this.picker.find(t.target).length||this.picker.hasClass("datepicker-inline")||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,a){var i=a||this.dates.get(-1),s=this._utc_to_local(i);this.element.trigger({type:e,date:s,dates:t.map(this.dates,this._utc_to_local),format:t.proxy(function(t,e){0===arguments.length?(t=this.dates.length-1,e=this.o.format):"string"==typeof t&&(e=t,t=this.dates.length-1),e=e||this.o.format;var a=this.dates.get(t);return m.formatDate(a,e,this.o.language)},this)})},show:function(){return this.element.attr("readonly")&&this.o.enableOnReadonly===!1?void 0:(this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&t(this.element).blur(),this)},hide:function(){return this.isInline?this:this.picker.is(":visible")?(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"),this):this},remove:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},paste:function(e){var a;if(e.originalEvent.clipboardData&&e.originalEvent.clipboardData.types&&-1!==t.inArray("text/plain",e.originalEvent.clipboardData.types))a=e.originalEvent.clipboardData.getData("text/plain");else{if(!window.clipboardData)return;a=window.clipboardData.getData("Text")}this.setDate(a),this.update(),e.preventDefault()},_utc_to_local:function(t){return t&&new Date(t.getTime()+6e4*t.getTimezoneOffset())},_local_to_utc:function(t){return t&&new Date(t.getTime()-6e4*t.getTimezoneOffset())},_zero_time:function(t){return t&&new Date(t.getFullYear(),t.getMonth(),t.getDate())},_zero_utc_time:function(t){return t&&new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()))},getDates:function(){return t.map(this.dates,this._utc_to_local)},getUTCDates:function(){return t.map(this.dates,function(t){return new Date(t)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var t=this.dates.get(-1);return"undefined"!=typeof t?new Date(t):null},clearDates:function(){var t;this.isInput?t=this.element:this.component&&(t=this.element.find("input")),t&&t.val(""),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,e),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,t.map(e,this._utc_to_local)),this._trigger("changeDate"),this.setValue(),this},setDate:n("setDates"),setUTCDate:n("setUTCDates"),setValue:function(){var t=this.getFormattedDate();return this.isInput?this.element.val(t):this.component&&this.element.find("input").val(t),this},getFormattedDate:function(a){a===e&&(a=this.o.format);var i=this.o.language;return t.map(this.dates,function(t){return m.formatDate(t,a,i)}).join(this.o.multidateSeparator)},setStartDate:function(t){return this._process_options({startDate:t}),this.update(),this.updateNavArrows(),this},setEndDate:function(t){return this._process_options({endDate:t}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(t){return this._process_options({daysOfWeekDisabled:t}),this.update(),this.updateNavArrows(),this},setDaysOfWeekHighlighted:function(t){return this._process_options({daysOfWeekHighlighted:t}),this.update(),this},setDatesDisabled:function(t){this._process_options({datesDisabled:t}),this.update(),this.updateNavArrows()},place:function(){if(this.isInline)return this;var e=this.picker.outerWidth(),a=this.picker.outerHeight(),i=10,s=t(this.o.container),n=s.width(),o=s.scrollTop(),r=s.offset(),h=[];this.element.parents().each(function(){var e=t(this).css("z-index");"auto"!==e&&0!==e&&h.push(parseInt(e))});var l=Math.max.apply(Math,h)+this.o.zIndexOffset,d=this.component?this.component.parent().offset():this.element.offset(),c=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),u=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),p=d.left-r.left,f=d.top-r.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(p-=e-u)):d.left<0?(this.picker.addClass("datepicker-orient-left"),p-=d.left-i):p+e>n?(this.picker.addClass("datepicker-orient-right"),p=d.left+u-e):this.picker.addClass("datepicker-orient-left");var g,D=this.o.orientation.y;if("auto"===D&&(g=-o+f-a,D=0>g?"bottom":"top"),this.picker.addClass("datepicker-orient-"+D),"top"===D?f-=a+parseInt(this.picker.css("padding-top")):f+=c,this.o.rtl){var m=n-(p+u);this.picker.css({top:f,right:m,zIndex:l})}else this.picker.css({top:f,left:p,zIndex:l});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var e=this.dates.copy(),a=[],i=!1;return arguments.length?(t.each(arguments,t.proxy(function(t,e){e instanceof Date&&(e=this._local_to_utc(e)),a.push(e)},this)),i=!0):(a=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),a=a&&this.o.multidate?a.split(this.o.multidateSeparator):[a],delete this.element.data().date),a=t.map(a,t.proxy(function(t){return m.parseDate(t,this.o.format,this.o.language)},this)),a=t.grep(a,t.proxy(function(t){return t<this.o.startDate||t>this.o.endDate||!t},this),!0),this.dates.replace(a),this.viewDate=this.dates.length?new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?new Date(this.o.startDate):this.viewDate>this.o.endDate?new Date(this.o.endDate):this.o.defaultViewDate,i?this.setValue():a.length&&String(e)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&e.length&&this._trigger("clearDate"),this.fill(),this.element.change(),this},fillDow:function(){var t=this.o.weekStart,e="<tr>";for(this.o.calendarWeeks&&(this.picker.find(".datepicker-days .datepicker-switch").attr("colspan",function(t,e){return parseInt(e)+1}),e+='<th class="cw">&#160;</th>');t<this.o.weekStart+7;)e+='<th class="dow">'+D[this.o.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;12>e;)t+='<span class="month">'+D[this.o.language].monthsShort[e++]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(e){e&&e.length?this.range=t.map(e,function(t){return t.valueOf()}):delete this.range,this.fill()},getClassNames:function(e){var a=[],i=this.viewDate.getUTCFullYear(),n=this.viewDate.getUTCMonth(),o=new Date;return e.getUTCFullYear()<i||e.getUTCFullYear()===i&&e.getUTCMonth()<n?a.push("old"):(e.getUTCFullYear()>i||e.getUTCFullYear()===i&&e.getUTCMonth()>n)&&a.push("new"),this.focusDate&&e.valueOf()===this.focusDate.valueOf()&&a.push("focused"),this.o.todayHighlight&&e.getUTCFullYear()===o.getFullYear()&&e.getUTCMonth()===o.getMonth()&&e.getUTCDate()===o.getDate()&&a.push("today"),-1!==this.dates.contains(e)&&a.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&a.push("disabled"),-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekHighlighted)&&a.push("highlighted"),this.o.datesDisabled.length>0&&t.grep(this.o.datesDisabled,function(t){return s(e,t)}).length>0&&a.push("disabled","disabled-date"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&a.push("range"),-1!==t.inArray(e.valueOf(),this.range)&&a.push("selected"),e.valueOf()===this.range[0]&&a.push("range-start"),e.valueOf()===this.range[this.range.length-1]&&a.push("range-end")),a},fill:function(){var i,s=new Date(this.viewDate),n=s.getUTCFullYear(),o=s.getUTCMonth(),r=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),h=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),l=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,d=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,c=D[this.o.language].today||D.en.today||"",u=D[this.o.language].clear||D.en.clear||"",p=D[this.o.language].titleFormat||D.en.titleFormat;if(!isNaN(n)&&!isNaN(o)){this.picker.find(".datepicker-days thead .datepicker-switch").text(m.formatDate(new a(n,o),p,this.o.language)),this.picker.find("tfoot .today").text(c).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot .clear").text(u).toggle(this.o.clearBtn!==!1),this.picker.find("thead .datepicker-title").text(this.o.title).toggle(""!==this.o.title),this.updateNavArrows(),this.fillMonths();var f=a(n,o-1,28),g=m.getDaysInMonth(f.getUTCFullYear(),f.getUTCMonth());f.setUTCDate(g),f.setUTCDate(g-(f.getUTCDay()-this.o.weekStart+7)%7);var v=new Date(f);f.getUTCFullYear()<100&&v.setUTCFullYear(f.getUTCFullYear()),v.setUTCDate(v.getUTCDate()+42),v=v.valueOf();for(var y,w=[];f.valueOf()<v;){if(f.getUTCDay()===this.o.weekStart&&(w.push("<tr>"),this.o.calendarWeeks)){var k=new Date(+f+(this.o.weekStart-f.getUTCDay()-7)%7*864e5),C=new Date(Number(k)+(11-k.getUTCDay())%7*864e5),b=new Date(Number(b=a(C.getUTCFullYear(),0,1))+(11-b.getUTCDay())%7*864e5),T=(C-b)/864e5/7+1;w.push('<td class="cw">'+T+"</td>")}if(y=this.getClassNames(f),y.push("day"),this.o.beforeShowDay!==t.noop){var _=this.o.beforeShowDay(this._utc_to_local(f));_===e?_={}:"boolean"==typeof _?_={enabled:_}:"string"==typeof _&&(_={classes:_}),_.enabled===!1&&y.push("disabled"),_.classes&&(y=y.concat(_.classes.split(/\s+/))),_.tooltip&&(i=_.tooltip)}y=t.unique(y),w.push('<td class="'+y.join(" ")+'"'+(i?' title="'+i+'"':"")+">"+f.getUTCDate()+"</td>"),i=null,f.getUTCDay()===this.o.weekEnd&&w.push("</tr>"),f.setUTCDate(f.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(w.join(""));var M=this.picker.find(".datepicker-months").find(".datepicker-switch").text(this.o.maxViewMode<2?"Months":n).end().find("span").removeClass("active");if(t.each(this.dates,function(t,e){e.getUTCFullYear()===n&&M.eq(e.getUTCMonth()).addClass("active")}),(r>n||n>l)&&M.addClass("disabled"),n===r&&M.slice(0,h).addClass("disabled"),n===l&&M.slice(d+1).addClass("disabled"),this.o.beforeShowMonth!==t.noop){var U=this;t.each(M,function(e,a){if(!t(a).hasClass("disabled")){var i=new Date(n,e,1),s=U.o.beforeShowMonth(i);s===!1&&t(a).addClass("disabled")}})}w="",n=10*parseInt(n/10,10);var x=this.picker.find(".datepicker-years").find(".datepicker-switch").text(n+"-"+(n+9)).end().find("td");n-=1;for(var F,Y=t.map(this.dates,function(t){return t.getUTCFullYear()}),S=-1;11>S;S++){if(F=["year"],i=null,-1===S?F.push("old"):10===S&&F.push("new"),-1!==t.inArray(n,Y)&&F.push("active"),(r>n||n>l)&&F.push("disabled"),this.o.beforeShowYear!==t.noop){var O=this.o.beforeShowYear(new Date(n,0,1));O===e?O={}:"boolean"==typeof O?O={enabled:O}:"string"==typeof O&&(O={classes:O}),O.enabled===!1&&F.push("disabled"),O.classes&&(F=F.concat(O.classes.split(/\s+/))),O.tooltip&&(i=O.tooltip)}w+='<span class="'+F.join(" ")+'"'+(i?' title="'+i+'"':"")+">"+n+"</span>",n+=1}x.html(w)}},updateNavArrows:function(){if(this._allow_update){var t=new Date(this.viewDate),e=t.getUTCFullYear(),a=t.getUTCMonth();switch(this.viewMode){case 0:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()&&a<=this.o.startDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()&&a>=this.o.endDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"});break;case 1:case 2:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()||this.o.maxViewMode<2?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()||this.o.maxViewMode<2?{visibility:"hidden"}:{visibility:"visible"})}}},click:function(e){e.preventDefault(),e.stopPropagation();var i,s,n,o=t(e.target).closest("span, td, th");if(1===o.length)switch(o[0].nodeName.toLowerCase()){case"th":switch(o[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var r=m.modes[this.viewMode].navStep*("prev"===o[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,r),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,r),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var h=new Date;h=a(h.getFullYear(),h.getMonth(),h.getDate(),0,0,0),this.showMode(-2);var l="linked"===this.o.todayBtn?null:"view";this._setDate(h,l);break;case"clear":this.clearDates()}break;case"span":o.hasClass("disabled")||(this.viewDate.setUTCDate(1),o.hasClass("month")?(n=1,s=o.parent().find("span").index(o),i=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(s),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode?(this._setDate(a(i,s,n)),this.showMode()):this.showMode(-1)):(n=1,s=0,i=parseInt(o.text(),10)||0,this.viewDate.setUTCFullYear(i),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(a(i,s,n)),this.showMode(-1)),this.fill());break;case"td":o.hasClass("day")&&!o.hasClass("disabled")&&(n=parseInt(o.text(),10)||1,i=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),o.hasClass("old")?0===s?(s=11,i-=1):s-=1:o.hasClass("new")&&(11===s?(s=0,i+=1):s+=1),this._setDate(a(i,s,n)))}this.picker.is(":visible")&&this._focused_from&&t(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(t){var e=this.dates.contains(t);if(t||this.dates.clear(),-1!==e?(this.o.multidate===!0||this.o.multidate>1||this.o.toggleActive)&&this.dates.remove(e):this.o.multidate===!1?(this.dates.clear(),this.dates.push(t)):this.dates.push(t),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(t,e){e&&"date"!==e||this._toggle_multidate(t&&new Date(t)),e&&"view"!==e||(this.viewDate=t&&new Date(t)),this.fill(),this.setValue(),e&&"view"===e||this._trigger("changeDate");var a;this.isInput?a=this.element:this.component&&(a=this.element.find("input")),a&&a.change(),!this.o.autoclose||e&&"date"!==e||this.hide()},moveMonth:function(t,e){if(!o(t))return this.o.defaultViewDate;if(!e)return t;var a,i,s=new Date(t.valueOf()),n=s.getUTCDate(),r=s.getUTCMonth(),h=Math.abs(e);if(e=e>0?1:-1,1===h)i=-1===e?function(){return s.getUTCMonth()===r}:function(){return s.getUTCMonth()!==a},a=r+e,s.setUTCMonth(a),(0>a||a>11)&&(a=(a+12)%12);else{for(var l=0;h>l;l++)s=this.moveMonth(s,e);a=s.getUTCMonth(),s.setUTCDate(n),i=function(){return a!==s.getUTCMonth()}}for(;i();)s.setUTCDate(--n),s.setUTCMonth(a);return s},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.o.startDate&&t<=this.o.endDate},keydown:function(t){if(!this.picker.is(":visible"))return void((40===t.keyCode||27===t.keyCode)&&(this.show(),t.stopPropagation()));var e,a,s,n=!1,o=this.focusDate||this.viewDate;switch(t.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),t.preventDefault(),t.stopPropagation();break;case 37:case 39:if(!this.o.keyboardNavigation)break;e=37===t.keyCode?-1:1,t.ctrlKey?(a=this.moveYear(this.dates.get(-1)||i(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(a=this.moveMonth(this.dates.get(-1)||i(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(a=new Date(this.dates.get(-1)||i()),a.setUTCDate(a.getUTCDate()+e),s=new Date(o),s.setUTCDate(o.getUTCDate()+e)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;e=38===t.keyCode?-1:1,t.ctrlKey?(a=this.moveYear(this.dates.get(-1)||i(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(a=this.moveMonth(this.dates.get(-1)||i(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(a=new Date(this.dates.get(-1)||i()),a.setUTCDate(a.getUTCDate()+7*e),s=new Date(o),s.setUTCDate(o.getUTCDate()+7*e)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 32:break;case 13:if(!this.o.forceParse)break;o=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(o),n=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(t.preventDefault(),"function"==typeof t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(n){this._trigger(this.dates.length?"changeDate":"clearDate");var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change()}},showMode:function(t){t&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(this.o.maxViewMode,this.viewMode+t))),this.picker.children("div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).show(),this.updateNavArrows()}};var c=function(e,a){this.element=t(e),this.inputs=t.map(a.inputs,function(t){return t.jquery?t[0]:t}),delete a.inputs,p.call(t(this.inputs),a).on("changeDate",t.proxy(this.dateUpdated,this)),this.pickers=t.map(this.inputs,function(e){return t(e).data("datepicker")}),this.updateDates()};c.prototype={updateDates:function(){this.dates=t.map(this.pickers,function(t){return t.getUTCDate()}),this.updateRanges()},updateRanges:function(){var e=t.map(this.dates,function(t){return t.valueOf()});t.each(this.pickers,function(t,a){a.setRange(e)})},dateUpdated:function(e){if(!this.updating){this.updating=!0;var a=t(e.target).data("datepicker");if("undefined"!=typeof a){var i=a.getUTCDate(),s=t.inArray(e.target,this.inputs),n=s-1,o=s+1,r=this.inputs.length;if(-1!==s){if(t.each(this.pickers,function(t,e){e.getUTCDate()||e.setUTCDate(i)}),i<this.dates[n])for(;n>=0&&i<this.dates[n];)this.pickers[n--].setUTCDate(i);else if(i>this.dates[o])for(;r>o&&i>this.dates[o];)this.pickers[o++].setUTCDate(i);this.updateDates(),delete this.updating}}}},remove:function(){t.map(this.pickers,function(t){t.remove()}),delete this.element.data().datepicker}};var u=t.fn.datepicker,p=function(a){var i=Array.apply(null,arguments);i.shift();var s;if(this.each(function(){var e=t(this),n=e.data("datepicker"),o="object"==typeof a&&a;if(!n){var l=r(this,"date"),u=t.extend({},f,l,o),p=h(u.language),g=t.extend({},f,p,l,o);if(e.hasClass("input-daterange")||g.inputs){var D={inputs:g.inputs||e.find("input").toArray()};e.data("datepicker",n=new c(this,t.extend(g,D)))}else e.data("datepicker",n=new d(this,g))}"string"==typeof a&&"function"==typeof n[a]&&(s=n[a].apply(n,i))}),s===e||s instanceof d||s instanceof c)return this;if(this.length>1)throw new Error("Using only allowed for the collection of a single element ("+a+" function)");return s};t.fn.datepicker=p;var f=t.fn.datepicker.defaults={autoclose:!1,beforeShowDay:t.noop,beforeShowMonth:t.noop,beforeShowYear:t.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],daysOfWeekHighlighted:[],datesDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,maxViewMode:2,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,container:"body",immediateUpdates:!1,title:""},g=t.fn.datepicker.locale_opts=["format","rtl","weekStart"];t.fn.datepicker.Constructor=d;var D=t.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM yyyy"}},m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4===0&&t%100!==0||t%400===0},getDaysInMonth:function(t,e){return[31,m.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(t){if("function"==typeof t.toValue&&"function"==typeof t.toDisplay)return t;var e=t.replace(this.validParts,"\x00").split("\x00"),a=t.match(this.validParts);if(!e||!e.length||!a||0===a.length)throw new Error("Invalid date format.");return{separators:e,parts:a}},parseDate:function(i,s,n){function o(){var t=this.slice(0,u[l].length),e=u[l].slice(0,t.length);return t.toLowerCase()===e.toLowerCase()}if(!i)return e;if(i instanceof Date)return i;if("string"==typeof s&&(s=m.parseFormat(s)),s.toValue)return s.toValue(i,s,n);var r,h,l,c=/([\-+]\d+)([dmwy])/,u=i.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(i)){for(i=new Date,l=0;l<u.length;l++)switch(r=c.exec(u[l]),h=parseInt(r[1]),r[2]){case"d":i.setUTCDate(i.getUTCDate()+h);break;case"m":i=d.prototype.moveMonth.call(d.prototype,i,h);break;case"w":i.setUTCDate(i.getUTCDate()+7*h);break;case"y":i=d.prototype.moveYear.call(d.prototype,i,h)}return a(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),0,0,0)}u=i&&i.match(this.nonpunctuation)||[],i=new Date;var p,f,g={},v=["yyyy","yy","M","MM","m","mm","d","dd"],y={yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){if(isNaN(t))return t;for(e-=1;0>e;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!==e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)}};y.M=y.MM=y.mm=y.m,y.dd=y.d,i=a(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);var w=s.parts.slice();if(u.length!==w.length&&(w=t(w).filter(function(e,a){return-1!==t.inArray(a,v)}).toArray()),u.length===w.length){var k;for(l=0,k=w.length;k>l;l++){if(p=parseInt(u[l],10),r=w[l],isNaN(p))switch(r){case"MM":f=t(D[n].months).filter(o),p=t.inArray(f[0],D[n].months)+1;break;case"M":f=t(D[n].monthsShort).filter(o),p=t.inArray(f[0],D[n].monthsShort)+1}g[r]=p}var C,b;for(l=0;l<v.length;l++)b=v[l],b in g&&!isNaN(g[b])&&(C=new Date(i),y[b](C,g[b]),isNaN(C)||(i=C))}return i},formatDate:function(e,a,i){if(!e)return"";if("string"==typeof a&&(a=m.parseFormat(a)),a.toDisplay)return a.toDisplay(e,a,i);var s={d:e.getUTCDate(),D:D[i].daysShort[e.getUTCDay()],DD:D[i].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:D[i].monthsShort[e.getUTCMonth()],MM:D[i].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()};s.dd=(s.d<10?"0":"")+s.d,s.mm=(s.m<10?"0":"")+s.m,e=[];for(var n=t.extend([],a.separators),o=0,r=a.parts.length;r>=o;o++)n.length&&e.push(n.shift()),e.push(s[a.parts[o]]);return e.join("")},headTemplate:'<thead><tr><th colspan="7" class="datepicker-title"></th></tr><tr><th class="prev">&#171;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&#187;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table></div></div>",t.fn.datepicker.DPGlobal=m,t.fn.datepicker.noConflict=function(){return t.fn.datepicker=u,this},t.fn.datepicker.version="1.6.0-dev",t(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var a=t(this);a.data("datepicker")||(e.preventDefault(),p.call(a,"show"))}),t(function(){p.call(t('[data-provide="datepicker-inline"]'))})});
$(function(){function a(a){$(".schedule .card").bind("touchend",n),t=a.originalEvent.changedTouches[0].clientY,console.log("touch start",t)}function n(a){var n=a.originalEvent.changedTouches[0].clientY;Math.abs(t-n)>20&&(0>t-n?$(this).parent().removeClass("open"):$(this).parent().addClass("open"))}function e(){$($card).fadeOut(),$(".journey .message_2").fadeIn(),$(".journey .card img").attr("src","img/gfx_hand.svg");var a=clock_slider.activeBucket(),n=$(".bottomslider span.time").eq(a).html(),e=n.split(":"),t=parseInt(e[0]),s=parseInt(e[1]);s+=22,s>=60&&(s-=60,t+=1),$(".info").animate({opacity:0},0);var r='<span class="delay">Running behind</span>',i='<span class="platform">Platform 12</span><span class="delay">Exp '+pad(t,2)+":"+pad(s,2)+"</span>";$(".info.depart").html(r),$(".info.arrive").html(i),$(".info").animate({opacity:1},200)}var t=0;$(".journey .card").bind("touchstart",function(a){$card=$(a.target),$card.hasClass("message_1")?e():$(this).parent().hasClass("open")?$(this).parent().removeClass("open"):$(this).parent().addClass("open")}),$(".schedule .card").bind("touchstart",a)});
function swapStations(t){var e=$(".top .location").html(),n=$(".bottom .location").html();$(".bottom .location").html(e),$(".top .location").html(n),t.preventDefault()}function parentHasClass(t,e){return t.className.indexOf(e)<0?t!=document.body?parentHasClass(t.parentNode,e):!1:!0}function pad(t,e,n){return n=n||"0",t+="",t.length>=e?t:new Array(e-t.length+1).join(n)+t}var currentTime,clock_slider=function(){function t(t,e,n,a){var o,s;l=t,$bucket=$(".options time",$(".clock_slider").eq(0)).eq(l);var r=$bucket.attr("data-message"),i=$bucket.attr("datetime")+" ",i=i.trim().replace(" ","T"),i=new Date(i),d=new Date;i.setHours(i.getHours()-1),$(".journey .plan li").each(function(t,e){var n=new Date(i.getTime()+6e4*parseInt($(this).attr("data-distance"))),a=pad(n.getHours(),2)+":"+pad(n.getMinutes(),2);4>t&&d>i?$(this).addClass("passed"):$(this).removeClass("passed"),$("strong",$(this)).html(a)}),d>i?$(".current_status").css("display","block"):$(".current_status").css("display","none");var d=new Date;c>t?(o='<span class="journey_link">Running on time</span>',s='<span class="platform">Platform 4: Train to Preston</span><span class="delay">Expected on time</span>'):t==c?(o='<span class="platform">Platform 15: Train to Preston</span><span class="delay">Expected on time</span>',s='<span class="delay">Expected on time</span>'):(o='<span class="delay">Exp on time</span>',s='<span class="delay">Expected on time</span>'),e?(e>.5&&(e=.5),$(".options",n).css("transition","all "+e+"s ease-out")):$(".options",n).css("transition","all 0s cubic-bezier(.6,.0,.4,1)");var p=0-t*$(".clock_slider .options time").width();$(".options",n).css("transform","translateX("+(p+(h/2-$("time.bucket").width()/2))+"px)"),$(".info").animate({opacity:0},200),setTimeout(function(t){t?($(".info.depart").html(o),$(".info.arrive").html(s)):($(".info.depart").html(o),$(".info.arrive").html(s)),$(".info").animate({opacity:1},200)},350,r)}function e(t){var e=$(t.target.parentNode.parentNode.parentNode.parentNode);scrollBucket=e,$(".clock_slider").removeClass("active"),e.addClass("active"),m=scrollBucket.scrollTop,u=0;(new Date).getTime()-r;$(".options",e).bind("touchend",a).bind("touchmove",n).css("transition-duration","0s");var o=$(".options",e).css("transform").toString().replace("matrix(","").replace(")","").split(",");d.touchOffsetX=parseInt(o[4].trim()),d.x=t.originalEvent.touches[0].clientX,r=(new Date).getTime()}function n(t){var e=$(t.target.parentNode.parentNode.parentNode.parentNode);clearTimeout(i);var n=$(".options",e).css("transform").toString().replace("matrix(","").replace(")","").split(",");p.x=t.originalEvent.touches[0].clientX,p.touchOffsetX=parseInt(n[4].trim()),u=d.x-p.x;var a=((new Date).getTime()-r,-1*(d.x-p.x-d.touchOffsetX));$(".options",e).css("transform","translateX("+a+"px)")}function a(e){var o=$(e.target.parentNode.parentNode.parentNode.parentNode);clearTimeout(i),$(".options",o).css("transition-duration","0.4s").unbind("touchmove",n).unbind("touchend",a);var s=(new Date).getTime()-r,c=d.x-p.x,m=Math.round(c/$(".options time",o).width());m=l+m,0>m&&(m=0);var h=.6*Math.abs(s/u);console.log(h),.2>h&&(h=.2),t(m,h)}function o(t){var e=new Date,n=e.getHours(),a=e.getMinutes();m_rounded=5*Math.ceil(a/5),60==m_rounded&&(m_rounded=0,n+=1),m_rounded+=5;var o=(pad(n,2)+":"+pad(m_rounded,2),0);return $(".options time span",$(t)).each(function(t,e){return thisHour=parseInt($(this).html().substring(0,2)),thisMinute=parseInt($(this).html().substring(3,5)),thisHour==n&&thisMinute>=m_rounded||thisHour>n?(o=t,!1):void 0}),o}function s(t){function e(t){try{var e=Math.abs(h/2-(t.getBoundingClientRect().left+t.getBoundingClientRect().width/2))}catch(n){}return e}try{var n=document.querySelector(t),a=document.elementFromPoint(h/2,n.getBoundingClientRect().top+5).parentNode;if("undefined"!=typeof a&&"TIME"==a.tagName){var o=new Array;o.push(a),o.push(a.parentNode.previousSibling.firstChild),o.push(a.parentNode.nextSibling.firstChild);for(object in o)"undefined"!=o[object]&&(centerMeasure=-1*e(o[object]),centerMeasure!=n.centerMeasure&&(spanTime=o[object].firstChild,o[object].centerMeasure=centerMeasure,centerScale=Math.abs(centerMeasure.map(-100,0,1,1.6)),centerOpacity=centerMeasure.map(-180,0,.3,1),spanTime.getAttribute("data-centerscale")!=centerScale&&(centerScale<1&&(centerScale=1),spanTime.setAttribute("data-centerscale",centerScale),$(spanTime).css("transform","scale("+centerScale+","+centerScale+")").css("opacity",centerOpacity))))}}catch(s){}}var r,i,c,l=0,d=new Object,p=new Object,u=0,m=0,h=$(window).width();return Number.prototype.map=function(t,e,n,a){return(this-t)*(a-n)/(e-t)+n},{draw:function(){s(".topslider"),s(".bottomslider"),setTimeout(clock_slider.draw,10)},Init:function(n,a){var s=o(n);c=s,$(".options",$(".clock_slider")).bind("touchstart",e),t(s,!1,$(".clock_slider").eq(0)),t(s,!1,$(".clock_slider").eq(1)),$(".clock_slider").each(function(){$(this)[0].fromTop=$(this).offset().top}),$("a.swap").bind("click",swapStations),clock_slider.draw(),"#scanner"==document.location.hash&&($("body").removeClass("pre"),$(".top .location").html("London Euston").addClass("valid"),$(".bottom .location").html("Birmingham New Street").addClass("valid"),$(".get_tickets button").prop("disabled",!1))},activeBucket:function(){return l}}}();
var headerMinHeight=null,historyCount=0;$(function(){function e(){$("body").hasClass("step1")&&(document.location.href="planning.php"),$("body").hasClass("step2")&&($("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step1"),trainDirection="outbound",setSlideMinNow(),updatePriceList(),$(".outbound li, .returning li, .ticket_options li").removeClass("faded"),$(".schedule_container .opacityZero").css("opacity",0),schedule.sizeUp()),$("body").hasClass("step3")&&($("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step2"),updatePriceList(),trainDirection="returning",$(".schedule_container .opacityZero").css("opacity",0),$(".outbound li, .returning li, .ticket_options li").removeClass("faded"),schedule.sizeUp()),$("body").hasClass("step4")&&!$("body").hasClass("confirmation-page")&&($("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step3"),$(".schedule_container .opacityZero").css("opacity",0),$(".ticket_options li").removeClass("faded"),schedule.sizeUp()),$("body").hasClass("confirmation-page")&&(document.location.href="index.php#scanner")}function s(e){var s=$(window).scrollTop(),a=5;s>a&&!$("body").hasClass("scrolled")?$("body").addClass("scrolled"):a>=s&&$("body").removeClass("scrolled")}headerMinHeight=parseInt($(".headerMinHeight").css("height"));try{webkit.messageHandlers.callbackHandler.postMessage("white")}catch(a){}$(".back_nav").bind("click",function(){$("body").hasClass("helper")?document.location.hash="helper":$("body").hasClass("schedule")?e():$("body").hasClass("planning")?document.location.href="index.php#scanner":history.go(-1)}),$(window).bind("scroll",s),$("a.filters").bind("click",function(e){return $(".swt_modal").addClass("active"),$("body").addClass("modals"),$(".swt_modal > div").removeClass("active"),$(".back_nav").addClass("inactive"),$(".swt_modal .departure_controls").addClass("active"),$(".swt_modal").removeClass("trainmessage"),$("a.burger").addClass("close-button"),e.preventDefault(),!1}),$("a.burger").bind("click",function(e){return $("body").hasClass("schedule")&&historyCount++,$(window).unbind("hashchange"),$("header.controls").removeClass("toolactive navigateactive"),$(this).hasClass("close-button")?($("body").removeClass("station_picker"),$(".swt_modal").hasClass("active")?($(".swt_modal").removeClass("active train_message"),$("body").removeClass("modals"),$(".back_nav").removeClass("inactive")):(closeJourneyScreen(),$("body").removeClass("helper"),setTimeout(enterHomeScreen,550),setTimeout(function(){setTimeout(function(){$(".home .top").css("transition-duration","0.4s").css("transition-timing-function","cubic-bezier(0,.91,.12,.99)"),$(".home .bottom").css("transition-duration","0.4s").css("transition-timing-function","cubic-bezier(0,.91,.12,.99)")},100),setTimeout(function(){$(".home .top").css("transform","translateY(0)").css("opacity",1),$(".home .bottom").css("transform","translateY(0)").css("opacity",1)},110)},200)),$(this).removeClass("close-button")):$(this).hasClass("signpost")?($("section.helper").hasClass("choices")||$("section.helper").hasClass("profile")?(document.location.hash="",setTimeout(function(){$("body").removeClass("helper"),$("header .price").removeClass("inactive"),$("a.burger").removeClass("signpost"),$("section.helper").removeClass("active"),$("div.search_station").removeClass("inactive")},450)):(document.location.hash="",$("body").removeClass("helper"),$("header .price").removeClass("inactive"),$(this).removeClass("signpost"),$("section.helper").removeClass("active"),$("div.search_station").removeClass("inactive")),$(".choice_info").html("")):(document.location.hash="helper",hashChangeHandler(),$("body").addClass("helper"),$(this).addClass("signpost"),$("section.helper").unbind()),$(window).bind("hashchange",hashChangeHandler),e.preventDefault(),!1}),$(".choices-menu button.journey_alerts").bind("click",function(){historyCount++,$(window).unbind("hashchange"),document.location.hash="journey_alerts",$("header.controls").removeClass("toolactive").addClass("navigateactive"),$("section.helper").addClass("choices"),$(window).bind("hashchange",hashChangeHandler)}),$(".controls .profile").bind("click",function(e){"inline"==$(".touch_test").css("display")?(e.preventDefault(),document.location.href="profile.php"):(e.preventDefault(),document.location.hash="profile")})});
function setSlideMinNow(){var e=new Date,t=Math.floor(.5*e.getHours());$(".departure_controls .range_slider").slider({values:[t,12]})}function resetSlideHandler(){$(".departure_controls .range_slider").slider({values:[0,12]})}function slideHandler(e,t){sliderValues=t.values;var r=2*t.values[0]*36e5,a=2*t.values[1]*36e5;$(".range_slider").removeClass("zero"),0==t.values[0]&&$(".range_slider").addClass("zero"),$(".range_slider").removeClass("full"),12==t.values[1]&&$(".range_slider").addClass("full");var n=Math.floor(r/1e3/60/60),l=Math.floor(r/1e3/60)-60*n,c=Math.floor(a/1e3/60/60),o=Math.floor(a/1e3/60)-60*c;for($(".departure_controls .range_info").html(pad(n,2)+":"+pad(l,2)+" - "+pad(c,2)+":"+pad(o,2)),$(".departure_controls .price_stat ol li").removeClass("inactive"),i=0;i<t.values[0];i++)$(".departure_controls .price_stat ol li:nth-child("+(i+1)+")").addClass("inactive");for(i=t.values[1];i<12;i++)$(".departure_controls .price_stat ol li:nth-child("+(i+1)+")").addClass("inactive");if("slidechange"==e.type){var s={departure_ms:{gte:r,lte:a},direction:trainDirection};dataHandler(departure_data,s),schedule.Update()}}function calculatePrice(e){var t=(new Array,localStorage.getObject("selected_outbound")),r=localStorage.getObject("selected_returning");t.cheapest_single||(t=localStorage.getObject("cheapest_outbound")),r.cheapest_single||(r=localStorage.getObject("cheapest_outbound"));var a=localStorage.getItem("adults"),i=localStorage.getItem("children"),n=t.cheapest_single+r.cheapest_single;if(t.cheap_rtn_1&&r.cheap_rtn_1)var l=cheapReturn1,c="Valid for off-peak trains only";else if(t.cheap_rtn_2&&r.cheap_rtn_2)var l=cheapReturn2,c="Valid for off-peak trains only. Enjoy a free lunch with this ticket.";else l=t.cheapest_single+r.cheapest_single;if(n>l){cheapestTicketPrice=l,currentCheapestPrice=a*cheapestTicketPrice+i*cheapestTicketPrice*childFactor;var o='<li>\n			<div class="price">£'+l+'</div>\n			<div class="name">Off-peak Return</div>\n			<div class="description"><small>Valid for off-peak trains only</small></div>\n		</li>\n		<li>\n			<div class="price">£'+1.75*l+'</div>\n			<div class="name">First Off-peak Return</div>\n			<div class="description"><small>'+c+"</small></div>\n		</li>"}else{if(cheapestTicketPrice=n,currentCheapestPrice=a*cheapestTicketPrice+i*cheapestTicketPrice*childFactor,t.cheap_rtn_1||t.cheap_rtn_2)var s="Off-peak",d="Ticket valid for off-peak trains only on outbound journey.",u=d+" Enjoy a free lunch on the outbound train.";else var s="Anytime",d="Ticket valid for all trains on outbound journey.",u=d+" Enjoy a free lunch on the outbound train.";if(r.cheap_rtn_1||r.cheap_rtn_2){var p="Off-peak Combo",h="Ticket valid for off-peak trains only on returning journey.",f=h+" Enjoy a free lunch on the returning train.";"Off-peak"==s&&(h="",f="",d="Ticket valid for off-peak trains only.",u=d+" Enjoy a free lunch on the returning train.")}else{var p="Anytime Combo",h="Ticket valid for all trains on returning journey.",f=h+" Enjoy a free lunch on the returning train.";u.indexOf("lunch")>-1&&(u=d,f=h+" Enjoy a free lunch on both trains."),"Anytime"==s&&(h="",f="",d="Ticket valid for all trains.",u=d+" Enjoy a free lunch on both trains.")}var o='<li>\n			<div class="price">£'+currentCheapestPrice.toFixed(2)+'</div>\n			<div class="name">'+s+" + "+p+'</div>\n			<div class="description"><small>'+d+" "+h+'</small></div>\n		</li>\n		<li>\n			<div class="price">£'+(1.75*currentCheapestPrice).toFixed(2)+'</div>\n			<div class="name" title="'+s+" + "+p+' First">Upgrade to first class</div>\n			<div class="description"><small>'+u+" "+f+"</small></div>\n		</li>"}return $(".ticket_options ul").html(o+'<li><a href="#">Show other ticket options</a></li>'),$(".ticket_options ul li").bind("click",schedule.ScheduleStep),$(".schedule .sticky_info .price .amount, .schedule .controls .price .amount, .schedule .itinerary_container .price .amount").html("£"+currentCheapestPrice.toFixed(2)),$(".itinerary .travel_list .price").html("£"+currentCheapestPrice.toFixed(2)),$(".schedule button.buy .amount").html("£"+currentCheapestPrice.toFixed(2)),currentCheapestPrice}function calculatePriceDifference(e){var t=!1,r=!0,a=localStorage.getObject("selected_outbound"),i=localStorage.getObject("selected_returning");a.cheapest_single||(a=localStorage.getObject("cheapest_outbound")),i.cheapest_single||(i=localStorage.getObject("cheapest_outbound"));var n=localStorage.getItem("adults"),l=localStorage.getItem("children");"outbound"==trainDirection?a=e:i=e;var c=a.cheapest_single+i.cheapest_single;if(a.cheap_rtn_1&&i.cheap_rtn_1){var o=cheapReturn1;t=!0}else if(a.cheap_rtn_2&&i.cheap_rtn_2){var o=cheapReturn2;t=!0}else o=a+i;return c>o?cheapestTicketPrice=o:(cheapestTicketPrice=c,r=!1),thisCheapestPrice=n*cheapestTicketPrice+l*cheapestTicketPrice*childFactor,localStorage.setItem("offpeak",t),localStorage.setItem("returnTicket",r),thisCheapestPrice-currentCheapestPrice}function dataHandler(e,t){if("undefined"==typeof e&&(e=globalJSON,"undefined"==typeof e))return!1;var r=TAFFY(e);prevPeak=!0;if("undefined"==typeof t.departure_ms&&0==departurePriceAverageTemp.length)for(i=0;i<12;i++){var a=new Array;departurePriceAverageTemp.push(a)}var n=r(t).order("cheapest_single").first();globalAdultPrice=n.cheapest_single,globalChildPrice=globalAdultPrice*childFactor;var l=clone(t);l.direction="returning",localStorage.setObject("cheapest_outbound",r(t).order("cheapest_single").first()),localStorage.setObject("cheapest_returning",r(l).order("cheapest_single").first());{var c=calculatePrice(r(t).order("cheapest_single").first().cheapest_single);c+calculatePrice(r(l).order("cheapest_single").first().cheapest_single)}document.querySelector("."+trainDirection+" ul.travel_list").innerHTML="",r(t).order(sortField).each(function(e){var r=e.cheap_rtn_1||e.cheap_rtn_2;prevPeak!=r&&(prevPeak=r);var a=e.cheapest_single,i=e.cheapest_single*childFactor,n=localStorage.getItem("adults")*a+localStorage.getItem("children")*i,l=new Date,c=e.departure.split(":"),o=new Date(l.getFullYear(),l.getMonth(),l.getDate(),c[0],c[1],0,0),s=new Date(o),d="Valid anytime";e.cheap_rtn_1&&e.cheap_rtn_2&&(d="Off-peak"),s.setTime(s.getTime()+60*e.duration*1e3);{var u=document.createElement("li");Math.round(10*(n-currentCheapestPrice))/10}u.journeyData=e;var p=calculatePriceDifference(e);u.innerHTML='<div class="price">'+formatPrice(p)+"</div>\n							<datetime>"+e.departure+'</datetime><span class="arrow"></span><a href="#" class="changes">'+e.changes+'</a><span class="arrow"></span><datetime>'+pad(s.getHours(),2)+":"+pad(s.getMinutes(),2)+'</datetime><br>\n							<span class="valid_info">'+d+'</span><span class="platform">Platform '+e.platform+'</span><span class="duration">'+formatMinutes(e.duration)+"</span>",(""!=e.delay||""!=e.offer_header)&&(footerHTML="<footer>",""!=e.delay&&(footerHTML+='<span class="delay">'+e.delay+"</span>"),""!=e.offer_header&&(footerHTML+='<span class="offer"><span class="header">'+e.offer_header+'</span><span class="offer_icon"><img src="img/'+e.offer_icon+'.svg"></span><span class="offer_message"><p>'+e.offer_message+"</p></span></span>"),footerHTML+="</footer>",u.innerHTML+=footerHTML),u.journeyData.cheapest_single_child=e.cheapest_single*childFactor,u.addEventListener("click",schedule.ScheduleStep),document.querySelector("."+e.direction+" ul.travel_list").appendChild(u);var h=Math.floor(parseInt(c[0])/2);if("undefined"==typeof t.departure_ms){var f=departurePriceAverageTemp[h];f.push(e.cheapest_single)}}),$("ul.travel_list span.offer").bind("click",offerHandler)}function formatMinutes(e){var t=Math.floor(e/60),r=e-60*t;return t+"h "+r+"m"}function clone(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function formatPrice(e){var t;return t=0>e?"- £"+Math.abs(e).toFixed(2):"+ £"+e.toFixed(2)}function updatePriceList(){$("."+trainDirection+" ul.travel_list li").each(function(e,t){$(".price",$(t)).html(formatPrice(calculatePriceDifference(t.journeyData)))})}var departure_data,departurePriceAverageTemp=new Array,departurePriceAverage=new Array,sortField="departure_ms",sliderValues,cheapestTotal=0,trainDirection="outbound",globalJSON,cheapReturn1=28,cheapReturn2=51,feedFile="departures-eus_bhm.json",childFactor=.55;Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)};var nullObject=new Object;localStorage.setObject("cheapest_outbound",nullObject),localStorage.setObject("cheapest_returning",nullObject),localStorage.setObject("selected_outbound",nullObject),localStorage.setObject("selected_returning",nullObject);var currentCheapestPrice=0;$(function(){$("body.schedule").each(function(){$(".sort_by").bind("change",function(){sortField=$(".sort_by:checked").val(),console.log(sortField),$(".range_slider").slider({values:sliderValues}),$(window).scrollTop(0)}),$(".departure_controls .range_slider").slider({range:!0,min:0,max:12,values:[0,12],change:slideHandler,slide:slideHandler});$.getJSON("feeds/"+feedFile,{format:"json"},function(e){departure_data=e;globalJSON=e,dataHandler(e,{direction:trainDirection}),schedule.Update();var t=new Array;for(i=0;i<12;i++){var r=0;for(a=0;a<departurePriceAverageTemp[i].length;a++)r+=departurePriceAverageTemp[i][a];departurePriceAverage[i]=r>0?r/departurePriceAverageTemp[i].length:0,console.log("Average price: "+Math.floor(2*i)+"-"+(Math.floor(2*i)+2)+": "+departurePriceAverage[i],departurePriceAverage[i]/8*100),$(".departure_controls .price_stat ol li:nth-child("+(i+1)+") .bar").css("height",departurePriceAverage[i]/8*100+"%"),t.push({x:2*i,y:departurePriceAverage[i]})}t.push({x:24,y:departurePriceAverage[11]}),console.log(t);var n=new CanvasJS.Chart("chartContainer",{animationEnabled:!0,axisY:{tickLength:0,labelFontFamily:"Roboto",lineThickness:.5,gridThickness:0,tickThickness:0,labelFontSize:10,labelFormatter:function(e){return"£"+e.value}},axisX:{interval:2,minimum:0,labelFontFamily:"Roboto",tickLength:7,lineThickness:.5,gridThickness:0,tickThickness:0,margin:10,labelFontSize:10},data:[{type:"splineArea",markerSize:0,color:"rgba(67,181,102,.7)",dataPoints:t}]});n.render()}).done(function(){}).fail(function(e){console.log("error",e)});setTimeout(setSlideMinNow,200)})});
var keyboardTimeout,searchTimeout,activeInput;$(function(){function t(t){clearTimeout(keyboardTimeout);var n=$("input.station").val();""==n&&(n="a"),e(n)}function e(t){$("ul.list").html('<li><span class="searching"></span></li>'),clearTimeout(searchTimeout),searchTimeout=setTimeout(function(){$("ul.list").css("opacity",0).html('<li style="opacity:0" class="clickaction"><a href="javascript:void(0);">Birmingham Arena</a></li><li style="opacity:0" class="remove" class="clickaction"><a href="javascript:void(0);"">Birmingham City Centre</a></li>'),$("ul.list").animate({opacity:1},300),$("ul.list li").each(function(t,e){setTimeout(function(t){$(t).animate({opacity:1},300)},200*t+200,e)}).bind("click",function(){closeDestinationScreen(),$("div.search_station").addClass("inactive"),setTimeout(function(){enterLocating()},1600)})},1e3),keyboardTimeout=setTimeout(n,1500)}function n(){$("input.station").blur()}function i(t,e){if($(e).val().length>0){var n=new Date,i=new Date(e.min),a=new Date($(e).val());i>a&&(a=i,$(e).val(a));var o=a.getTimezoneOffset(),l="",r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if("outbound"==$(e).attr("id")){localStorage.setItem("outbound",a);var u=new Date($("#return").val());document.getElementById("return").min=$(e).val(),a>u?(document.getElementById("return").value="",$("#return").next().next().val("")):0==$("#return").next().val().length&&$("#return").attr("value",$(e).val())}else localStorage.setItem("returning",a);a.setMinutes(a.getMinutes()+o),l=a.getDate()==n.getDate()&&a.getMonth()==n.getMonth()&&a.getYear()==n.getYear()?"Today":r[a.getMonth()]+" "+a.getDate(),$(t).val(l)}}function a(t,e){return Array(Math.max(e-String(t).length+1,0)).join(0)+t}$("body.home .location").bind("click",function(){activeInput=this,this.blur(),$("body").addClass("station_picker"),$(".burger").addClass("close-button")}),$("body.home .station_list li").bind("click",function(){$(activeInput).html(this.innerHTML).addClass("valid"),$("body").removeClass("station_picker"),$(".burger").removeClass("close-button"),"&nbsp;"!=$(".top .location").html()&&"&nbsp;"!=$(".bottom .location").html()&&$(".get_tickets button").prop("disabled",!1)}),$("input.station").bind("keyup",t),$("#return").bind("focus",function(){$(".extra").addClass("open"),console.log("first "+window.innerHeight),setTimeout(function(){$(".extra").css("top",$(window).scrollTop()),console.log("second "+window.outerHeight,$(window).scrollTop())},300)}),$("#return").bind("blur",function(){$(".extra").removeClass("open")}),$("input[type=date]").bind("change",function(){i($(this).next().next()[0],this)}),$(".planning radiogroup input[type=radio]").bind("click",function(){switch($(this).prop("checked",!0),$("input[type=radio]:checked",$(this).parent()).attr("value")){case"single":$(".dates").removeClass("double"),$(".dates .return input").prop("disabled",!0),globalAdultPrice=6,globalChildPrice=globalAdultPrice*childFactor;break;case"return":$(".dates .return input").prop("disabled",!1),"Open"==$(".return input[type=text]").val()&&$(".return input[type=text]").val(""),globalAdultPrice=12,globalChildPrice=globalAdultPrice*childFactor,i($(".return input[type=text]"),$(".return input[type=date]")),$(".dates").addClass("double");break;case"open-return":$(".dates").addClass("double"),$(".return input[type=text]").val("Open")}var t=adults.value*globalAdultPrice,e=children.value*globalChildPrice,n=parseFloat(Math.round(10*(t+e))/10);$("header.controls .price .amount").html("£"+n.toFixed(2)),$("button.buy .amount").html("£"+n.toFixed(2))}),$("input[type=date]").each(function(){var t=new Date;document.getElementById(this.id).min=t.getYear()+1900+"-"+a(t.getMonth()+1,2)+"-"+a(t.getDate(),2),"date"!=$(this).prop("type")&&$(this).datepicker()})});
function hashChangeHandler(e){var a,s=document.location.hash.replace("#","");switch(console.log("hash: "+s),s){case"helper":$("body").hasClass("helper")||(a=$("header.controls .page_title span").html(),page_title_display=$("header.controls .page_title").css("display")),locate=$("body").hasClass("locate"),$("section.helper").hasClass("active")||(console.log("come on"),$(".back_nav").addClass("inactive"),$(".controls .profile").removeClass("inactive"),$("body").addClass("helper").removeClass("profile"),$("header.controls .page_title span").html("Concierge"),$("header.controls .page_title").css("display","block"),$(this).addClass("signpost"),$("div.search_station").addClass("inactive"),$("header.controls").addClass("toolactive"),$("section.helper").removeClass("choices profile"),$(".choice_info").html(""),$(".helper .navigate").removeClass("active"),$(window).scrollTop(0),setTimeout(function(){try{webkit.messageHandlers.callbackHandler.postMessage("white")}catch(e){}},600));break;case"journey_alerts":$("header .price").addClass("inactive"),$("body").addClass("helper").removeClass("profile"),$(this).addClass("signpost"),$(".helper .navigate").addClass("active"),$("section.helper").addClass("choices"),$(".back_nav").removeClass("inactive");break;case"profile":$(".controls .profile").addClass("inactive"),$(".back_nav").removeClass("inactive"),$("header .price").addClass("inactive"),$("section.helper").removeClass("choices"),$("body").addClass("helper").addClass("profile"),$(this).addClass("signpost"),$("div.search_station").addClass("inactive"),a=$("header.controls .page_title span").html(),setTimeout(function(){$("header.controls .page_title span").html("Profile"),$(".choice_info").html('<span class="name">Good morning<br><strong>John</strong></span><small>Log out</small>');try{webkit.messageHandlers.callbackHandler.postMessage("white")}catch(e){}},500);break;case"locating":break;default:openDestinationScreen(),$(".controls .profile").addClass("inactive"),$("body").hasClass("search_station")||$(".back_nav").removeClass("inactive"),$("footer").removeClass("active"),$(".route_vertical").removeClass("active"),$("header.controls").removeClass("toolactive navigateactive");try{webkit.messageHandlers.callbackHandler.postMessage("white")}catch(o){console.log("oh no")}if($("section.helper").hasClass("choices")||$("section.helper").hasClass("profile")){$("section.helper").removeClass("choices profile"),console.log("closing slowly"),document.location.hash="",setTimeout(function(){$("body").removeClass("helper"),$("header .price").removeClass("inactive"),$("a.burger").removeClass("signpost"),$("section.helper").removeClass("active"),$("div.search_station").removeClass("inactive"),$("header.controls .page_title span").html(a),$("header.controls .page_title").css("display",page_title_display)},450),$("body.home .back_nav").addClass("inactive");break}document.location.hash="",console.log("go back!"),$(".controls .profile").addClass("inactive"),$("body.home .back_nav").addClass("inactive"),$("header.controls .page_title span").html(a),$("header.controls .page_title").css("display",page_title_display),$("body").removeClass("helper"),$("header .price").removeClass("inactive"),$(this).removeClass("signpost"),$("section.helper").removeClass("active"),$("div.search_station").removeClass("inactive"),locate&&($("body").addClass("locate"),$(".route_vertical").addClass("active"),$("div.search_station").addClass("inactive")),$(".choice_info").html("")}}function helperToggle(e){$("body").hasClass("helper")||$("a.burger").trigger("click")}var page_title_display,locate=!1;$(function(){$("section.helper header .navigate a, section.helper .delete_message").bind("click",function(e){$(window).unbind("hashchange"),document.location.hash="helper",$("section.helper").removeClass("choices profile"),$(".choice_info").html(""),$("header.controls").removeClass("navigateactive").addClass("toolactive"),e.preventDefault(),$(window).bind("hashchange",hashChangeHandler)}),$("section.helper, section.helper .swt_avatar p").bind("click",helperToggle)});
!function(t,e,n){"use strict";function o(t,e,n,o,i){return Math.abs(t-n)<i&&Math.abs(e-o)<i}if(e.navigator.userAgent.match(/(iPhone|iPad|iPod)/)){var i={TOUCH_MOVE_THRESHHOLD:10,PRESSED_CLASS:"pressed",GHOST_CLICK_TIMEOUT:500,GHOST_CLICK_THRESHOLD:10},a=[];n.addEventListener("click",function(t){for(var e=0;e<a.length;e++)if(o(a[e][0],a[e][1],t.clientX,t.clientY,i.GHOST_CLICK_THRESHOLD))return t.preventDefault(),void t.stopPropagation()},!0),t(n).on("touchstart",".no_delay_button",function(e){var a=t(this);a.css("webkitTapHighlightColor","rgba(0,0,0,0)"),a.addClass(i.PRESSED_CLASS);var c=e.originalEvent.touches[0],s=[c.clientX,c.clientY];this.__eventLocation=s,this.__onTouchMove=function(t){var e=t.originalEvent.touches[0];o(e.clientX,e.clientY,s[0],s[1],i.TOUCH_MOVE_THRESHHOLD)?a.addClass(i.PRESSED_CLASS):a.removeClass(i.PRESSED_CLASS)},t(n.body).on("touchmove",this.__onTouchMove)}),t(n).on("touchcancel",".no_delay_button",function(){var e=t(this);e.removeClass(i.PRESSED_CLASS),t(n.body).off("touchmove",this.__onTouchMove)}),t(n).on("touchend",".no_delay_button",function(c){var s=t(this);if(s.hasClass(i.PRESSED_CLASS)){s.removeClass(i.PRESSED_CLASS);var u=this.__eventLocation;if(u){var _=c.originalEvent.changedTouches[0];if(!o(_.clientX,_.clientY,u[0],u[1],i.TOUCH_MOVE_THRESHHOLD))return;setTimeout(function(){var t=n.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,e,0,0,0,0,0,!1,!1,!1,!1,0,null),s.get(0).dispatchEvent(t)},1),c.preventDefault();var r=[_.clientX,_.clientY];a.push(r),e.setTimeout(function(){var t=a.indexOf(r);t>=0&&a.splice(t,1)},i.GHOST_CLICK_TIMEOUT)}}t(n.body).off("touchmove",this.__onTouchMove)})}}(jQuery,window,document);
var locationHandler=function(){function n(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(o)}function o(n){t=n,console.log(t)}var t;return{Init:function(){$(".planning button").bind("click",enterSchedule)},getLocation:function(){n()}}}();$(function(){$("body.search_station a").bind("click",function(n){n.preventDefault(),n.stopPropagation()})});
var globalAdultPrice=12,globalChildPrice=.55*globalAdultPrice,travellers=function(){function e(e){var t=(e.target,-1),l="adults";e.preventDefault(),category=e.target.parentNode.className,$(".travellers").hasClass("activated")||$(".travellers").addClass("activated"),"+"==e.target.innerHTML?(t=1,"adults"==category?(g%2?($(".travellers .stage").append('<img src="'+c[d]+'" class="adult">'),setTimeout(function(){$(".travellers .stage .adult:last").addClass("added"),setTimeout(function(e){e.addClass("inplace")},900,$(".travellers .stage .adult:last"))},200)):($(".travellers .stage").prepend('<img src="'+c[d]+'" class="adult">'),setTimeout(function(){$(".travellers .stage .adult:first").addClass("added"),setTimeout(function(e){e.addClass("inplace")},900,$(".travellers .stage .adult:first"))},200)),d++):(g%2?($(".travellers .stage").append('<img src="'+u[o]+'" class="child">'),setTimeout(function(){$(".travellers .stage .child:last").addClass("added"),setTimeout(function(e){e.addClass("inplace")},900,$(".travellers .stage .child:last"))},200)):($(".travellers .stage").prepend('<img src="'+u[o]+'" class="child">'),setTimeout(function(){$(".travellers .stage .child:first").addClass("added"),setTimeout(function(e){e.addClass("inplace")},900,$(".travellers .stage .child:first"))},200)),o++)):(t=-1,"adults"==category?(g%2?(setTimeout(function(e){e.remove()},850,$(".travellers .stage .adult.added").filter(":last")),$(".travellers .stage .adult.added").filter(":last").removeClass("added")):(setTimeout(function(e){e.remove()},850,$(".travellers .stage .adult.added").filter(":first")),$(".travellers .stage .adult.added").filter(":first").removeClass("added")),d--):(g%2?(setTimeout(function(e){e.remove()},850,$(".travellers .stage .child.added").filter(":last")),$(".travellers .stage .child.added").filter(":last").removeClass("added")):(setTimeout(function(e){e.remove()},850,$(".travellers .stage .child.added").filter(":first")),$(".travellers .stage .child.added").filter(":first").removeClass("added")),o--)),0>d&&(d=0),0>o&&(o=0),d>=c.length&&(d=0),o>=u.length&&(o=0),"adults"==category?i+=t:r+=t,0>i&&(i=0),0>r&&(r=0),g=i+r,$("input#adults").val(i),$("input#children").val(r),l=1==i?"adult":"adults",childrenLabel=1==r?"child":"children";var a=i*globalAdultPrice,s=r*globalChildPrice,n=parseFloat(Math.round(10*(a+s))/10);console.log(i,a),$("header.meta .price .amount, .controls .price .amount, header.itinerary_container .price .amount").html("£"+n.toFixed(2)),$(".planning button.buy .amount").html("£"+n.toFixed(2)),$(".travellers_info").html(i+" "+l+", "+r+" "+childrenLabel),$(".schedule_container .passengers").html(i+" "+l+", "+r+" "+childrenLabel),localStorage.setItem("adults",i),localStorage.setItem("children",r),$(".travellers_button button .adults").html(i),$(".travellers_button button .children").html(r)}function t(e){document.body.scrollHeight-$(window).height()-$(window).scrollTop()<20&&$(".sticky_info").addClass("next")}function l(){$(".railcards .choices").css("height",$(".railcards .choices")[0].scrollHeight)}function a(e){$(".row.travellers").toggleClass("visible")}function s(e){$("#from").val().length>0&&$("#to").val().length>0?($("body.planning").addClass("full"),setTimeout(function(){$("body.planning > h2").html("When do you want to travel?")},400)):($("body.planning").removeClass("full"),$("body.planning > h2").html("Where do you want to go?"))}function n(e){document.location.href="schedule.php"}var r=0,i=0,d=0,o=0,c=["img/gfx-passenger-male-2.svg","img/gfx-passenger-female-1.svg","img/gfx-passenger-male-1.svg","img/gfx-passenger-male-3.svg"],u=["img/gfx-passenger-child-1.svg"],g=1;return{Init:function(){$(".travellers_button button").bind("click",a),$(".travellers a").bind("click",e),$(".travellers .adults a:last-child").trigger("click"),$("body.planning .sticky_info").bind("click",n),$(".travellers .close-modal").bind("click",a),$("body.planning input").bind("keyup",s),$("body.planning input").bind("click",function(){setTimeout(s,100)}),$(".swap").bind("click",function(e){var t=$("input#to").val();return $("input#to").val($("input#from").val()),$("input#from").val(t),e.preventDefault(),e.stopPropagation(),!1}),$(window).bind("scroll",t),t(),$(".railcards .add").bind("click",l)}}}();$(function(){function e(t){console.log(t.target),$("body.planning").unbind("touchstart",e),$("img.eccentric_route").addClass("out")}travellers.Init(),$("body.planning").bind("touchstart",e),$("body.planning .eccentric_route").bind("touchstart",function(e){e.stopPropagation()});var t=document.referrer;"undefined"!=typeof t&&t.indexOf("schedule.php")&&window.scrollTo(0,0)});
function formatDate(e){var e=new Date(e),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=(e.getYear()+1900,t[e.getMonth()]),n=a[e.getDay()];return n+", "+i+" "+nth(e.getDay())}function offerHandler(e){console.log(e.target),e.stopPropagation(),$(".swt_modal .train_message").html($(".offer_icon",$(e.target)).html()+"<h3>"+$(".header",$(e.target)).html()+"</h3><p>"+$(".offer_message p",$(e.target)).html()+"</p>"),$(".swt_modal").addClass("active trainmessage"),$("a.burger").addClass("close-button")}function nth(e){if(e>3&&21>e)return e+"th";switch(e%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd";default:return e+"th"}}var schedule=function(){function e(e){r=$(window).innerHeight();var t=0,a=140;$("body").removeClass("final"),$(".schedule header.itinerary_container").removeClass("final"),$(window).innerWidth()<751?("undefined"==typeof e&&setTimeout(function(){$(".schedule").each(function(){o=TweenMax.to($("body"),1,{scrollTo:{y:0,x:0},ease:Power2.easeInOut})})},400),$("body").hasClass("step1")?($("header.meta .page_title span").html("Outbound train"),t=$("header.outbound").outerHeight(),n=a):$("body").hasClass("step2")?($("header.meta .page_title span").html("Return train"),t=$("header.returning").outerHeight(),n=95+a):$("body").hasClass("step3")?($("header.meta .page_title span").html("Ticket options"),t=$("header.ticket_options ").outerHeight(),n=187+a):$("body").hasClass("step4")&&($("header.meta .page_title span").html("Summary"),t=0,n=520+a,setTimeout(function(){$(".schedule").addClass("final")},400),setTimeout(function(){$(".page_title").css("display","block")},800)),$(".schedule header.itinerary_container").css("max-height",n),$(".schedule div.itinerary_background").css("transform","translateY(-"+($(".schedule div.itinerary_background").outerHeight()-(n+20))+"px)"),$("header.table").css("transform","translateY("+(n+20)+"px)"),$(".schedule .results").css("transform","translateY("+(n-100+t)+"px)")):$("body").hasClass("step4")?setTimeout(function(){$(".schedule").addClass("final")},400):(t=$("header.outbound").outerHeight(),n=120,$(".schedule header.itinerary_container").css("max-height",n),$(".schedule div.itinerary_background").css("transform","translateY(-"+($(".schedule div.itinerary_background").outerHeight()-(n+90))+"px)"),$("header.table").css("transform","translateY("+(n+90)+"px)"),$(".schedule .results").css("transform","translateY("+(n-100+t)+"px)"))}function t(t){var i=t.target;"LI"!=i.tagName&&(i=i.parentNode,"LI"!=i.tagName&&(i=i.parentNode));var n=i.journeyData,r=i.parentNode.parentNode;"UL"==r.tagName&&(r=r.parentNode);var o=r.className,u=$(r).index()+1,h=u+1;if(2==h&&localStorage.getObject("selected_returning").cheapest_single&&(u=1,h=3),$("body").removeClass("step"+u).addClass("step"+h),$("li",$(i).parent().parent()).addClass("faded"),"undefined"!=typeof n){var p=($(i).parent().hasClass("peak"),"Anytime, "+formatDate(localStorage.getItem(o)));(n.cheap_rtn_1||n.cheap_rtn_2)&&(p="Off-peak, "+formatDate(localStorage.getItem(o)))}switch(h){case 2:localStorage.setObject("selected_outbound",n),trainDirection="returning",resetSlideHandler(),l=calculatePrice(n.cheapest_single),dataHandler(globalJSON,{direction:trainDirection});break;case 3:2==u?(localStorage.setObject("selected_returning",n),console.log("switching"),c=calculatePrice(n.cheapest_single)):1==u&&(localStorage.setObject("selected_outbound",n),trainDirection="returning",l=calculatePrice(n.cheapest_single));break;case 4:console.log($(".price",$(i)).html());var g=$(".price",$(i)).html();d=parseFloat(g.replace("£","")),console.log(d)}Math.round(10*(l+c+s))/10;if("yes"==$("radiogroup.carpark input[type=radio]:checked").val()){var m=Math.round(10*(d+5))/10;$(".pricetag.total").html("£"+m.toFixed(2))}else{var m=Math.round(10*d)/10;$(".pricetag.total").html("£"+m.toFixed(2))}var f=Math.round(10*d)/10;$(".itinerary .travel_list .price").html("£"+f.toFixed(2)),$(".itinerary div."+o).next().html(p),$("datetime",$(i)).first().each(function(){$(".itinerary div."+o+" datetime").first().html($("datetime",$(i)).first().html()),$(".itinerary div."+o+" datetime").last().html($("datetime",$(i)).last().html()),$(".itinerary div."+o+" .changes").html(n.changes)});$(".price",$(i)).html().replace("+ £","");if(4==h){{var y=$(".name",$(i)).html();$(".price",$(i)).html().replace("+ £","")}"Upgrade to first class"==y&&(y=$(".name",$(i)).prop("title")),$(".ticket").html(y),e(),stepAnimateFast(".itinerary")}e(),a()}function a(e){$("ul.travel_list .range").each(function(){var e=$(this).parent().parent();"none"!=e.css("pointer-events")&&$(this).offset().top-e.offset().top<$(window).scrollTop()?($(this).attr("data-showing",!0),"true"!=$(this).next().attr("data-showing")):$(this).attr("data-showing",!1)})}function i(e){if("yes"==$("radiogroup.carpark input[type=radio]:checked").val()){$(".last-choices .pricetag.car").html("£5.00");var t=Math.round(10*(d+5))/10;$(".pricetag.total").html("£"+t.toFixed(2))}else{var t=Math.round(10*d)/10;$(".last-choices .pricetag.car").html("£0.00"),$(".pricetag.total").html("£"+t.toFixed(2))}}var n=$(".schedule .results .outbound header").outerHeight()+$(".schedule_container > header").outerHeight(),r=0,o=new Object,s=0,l=0,c=0,d=0;return o.kill=function(){},{Init:function(){$(window).innerWidth()>750&&$(window).bind("resize",e);parseInt(localStorage.getItem("adults")),parseInt(localStorage.getItem("children"));$(window).bind("mousewheel",function(e){o.kill()}),$(window).bind("touchstart",function(e){o.kill()}),$(window).bind("scroll",a),a(),setTimeout(a,200),setTimeout(a,500),setTimeout(a,1e3),$("li .changes").bind("click",function(e){return enterJourneyScreen(),e.preventDefault(),e.stopPropagation(),!1}),$("radiogroup.carpark input[type=radio]").bind("change",i),e(),$(".schedule .itinerary_container .stations").bind("click",function(e){return window.history.back(),e.preventDefault(),!1}),$(".itinerary .outbound_train, .itinerary datetime.outbound, .itinerary div.outbound").bind("click",function(){$("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step1"),trainDirection="outbound",setSlideMinNow(),updatePriceList(),$(".outbound li, .returning li, .ticket_options li").removeClass("faded"),$(".schedule_container .opacityZero").css("opacity",0),e()}),$(".itinerary .returning_train, .itinerary datetime.returning, .itinerary div.returning").bind("click",function(t){$("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step2"),updatePriceList(),trainDirection="returning",$(".schedule_container .opacityZero").css("opacity",0),$(".outbound li, .returning li, .ticket_options li").removeClass("faded"),e(t)}),$("h3.ticket_total").bind("click",function(){$("body").removeClass("step1 step2 step3 step4"),$("body").addClass("step3"),$(".schedule_container .opacityZero").css("opacity",0),$(".ticket_options li").removeClass("faded"),e()}),$(".last-choices button").bind("click",function(){$(".last-choices .final_wrapper").css("opacity",0),setTimeout(function(){$(".last-choices .final_wrapper").css("display","none"),$(".ticket_information").css("display","block").css("opacity",0),$(window).scrollTop(0),$(".last-choices").scrollTop(0),$("body").addClass("confirmation-page final"),$(".page_title").html("<span>Booking confirmation</span>"),$(".confirmation-header").addClass("active"),$(".outbound_train, .itinerary datetime.outbound, .itinerary div.outbound, .returning_train, h3.ticket, .stations, .itinerary .returning_train, .itinerary datetime.returning, .itinerary div.returning",$(".schedule")).addClass("final").unbind("click"),setTimeout(function(){$(".ticket_information").css("opacity",1),$(".cards").addClass("active")},20)},200)})},sizeUp:function(){e()},Update:function(){$(".results li").bind("click",t)},ScheduleStep:function(e){t(e)}}}();$(function(){$("body.schedule").each(function(){schedule.Init(),$("div, header, ul").bind("scroll",function(e){console.log("scrolling",e.target)}),$("header.outbound datetime").html('<!--<span class="peakvalue"></span>-->'+formatDate(localStorage.getItem("outbound"))),$("header.returning datetime").html('<!--<span class="peakvalue"></span>-->'+formatDate(localStorage.getItem("returning")));var e=localStorage.getItem("adults"),t=localStorage.getItem("children");adultLabel=1==e?"adult":"adults",childrenLabel=1==t?"child":"children",$("header .passengers").html(e+" "+adultLabel+", "+t+" "+childrenLabel)})});
//# sourceMappingURL=site.js.map